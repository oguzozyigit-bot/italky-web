<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>ITALKY ‚Ä¢ Meteor Defense</title>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;700;900&family=Space+Grotesk:wght@700&display=swap" rel="stylesheet">
  <style>
    /* --- TEMA: DEEP SPACE DEFENSE --- */
    :root {
      --bg: #020005;
      --ui-panel: rgba(20, 20, 30, 0.85);
      --neon-blue: #00f3ff;
      --neon-red: #ff0055;
      --neon-green: #00ff66;
      --meteor-color: #ffaa00;
      --text: #fff;
    }

    * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; outline: none; }
    body { margin: 0; width: 100%; height: 100%; overflow: hidden; position: fixed; font-family: 'Outfit', sans-serif; background: var(--bg); color: var(--text); }

    /* ARKA PLAN */
    .space-bg { position: absolute; inset: 0; background: radial-gradient(circle at bottom, #1a0033 0%, #000 100%); z-index: -2; }
    .stars { position: absolute; inset: 0; background-image: radial-gradient(#fff 1px, transparent 1px); background-size: 50px 50px; opacity: 0.3; z-index: -1; }

    /* OYUN ALANI */
    .game-container {
      position: relative; width: 100%; height: 100%; max-width: 480px; margin: 0 auto;
      display: flex; flex-direction: column; overflow: hidden;
      border-left: 1px solid rgba(255,255,255,0.1); border-right: 1px solid rgba(255,255,255,0.1);
    }

    /* HEADER */
    .header {
      flex: 0 0 60px; padding: 0 15px; display: flex; align-items: center; justify-content: space-between;
      background: linear-gradient(180deg, rgba(0,0,0,0.8), transparent); z-index: 20;
    }
    .back-btn { font-size: 24px; cursor: pointer; opacity: 0.8; }
    .score-board { font-family: 'Space Grotesk', sans-serif; font-size: 18px; font-weight: 700; color: var(--neon-blue); text-shadow: 0 0 10px var(--neon-blue); }
    .lives { letter-spacing: 2px; font-size: 14px; }

    /* SAHNE (Meteorlarƒ±n d√º≈üt√ºƒü√º yer) */
    .stage { flex: 1; position: relative; overflow: hidden; }

    /* METEOR */
    .meteor {
      position: absolute; left: 50%; top: -60px; transform: translateX(-50%);
      width: 100px; height: 100px;
      display: flex; align-items: center; justify-content: center;
      flex-direction: column;
      z-index: 10;
      transition: top 0.1s linear; /* JS ile s√ºr√ºlecek */
    }
    .meteor-body {
      width: 70px; height: 70px;
      background: radial-gradient(circle at 30% 30%, #ffcc00, #ff4400);
      border-radius: 50%;
      box-shadow: 0 0 20px #ff4400;
      display: flex; align-items: center; justify-content: center;
      border: 2px solid #fff;
      position: relative;
    }
    .meteor-body::after {
      content: ''; position: absolute; top: -10px; left: 0; right: 0; bottom: 0;
      background: transparent; box-shadow: 0 -10px 20px #ffaa00; border-radius: 50%; opacity: 0.5;
    }
    .meteor-text {
      color: #000; font-weight: 900; font-size: 13px; text-transform: uppercase;
      text-align: center; line-height: 1; z-index: 2; font-family: 'Space Grotesk', sans-serif;
    }
    .meteor-tail {
      position: absolute; top: -40px; width: 40px; height: 60px;
      background: linear-gradient(to top, #ff4400, transparent);
      opacity: 0.6; filter: blur(5px); z-index: 1;
    }

    /* KONTROL PANELƒ∞ (Silahlar) */
    .control-panel {
      flex: 0 0 240px; background: var(--ui-panel);
      border-top: 2px solid var(--neon-blue);
      border-radius: 20px 20px 0 0;
      padding: 15px;
      display: flex; flex-direction: column; gap: 10px;
      z-index: 30;
      box-shadow: 0 -5px 30px rgba(0, 243, 255, 0.2);
    }
    
    .turret-base {
      position: absolute; bottom: 230px; left: 50%; transform: translateX(-50%);
      width: 40px; height: 40px; background: var(--neon-blue);
      border-radius: 50% 50% 0 0; z-index: 25;
      box-shadow: 0 0 15px var(--neon-blue);
    }
    .laser-beam {
      position: absolute; width: 4px; background: var(--neon-green);
      transform-origin: bottom center; pointer-events: none; opacity: 0; z-index: 5;
      box-shadow: 0 0 10px var(--neon-green);
    }

    .options-grid {
      display: grid; grid-template-columns: 1fr 1fr; gap: 10px; height: 100%;
    }
    .opt-btn {
      background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2);
      border-radius: 12px; color: #fff; font-size: 16px; font-weight: 700;
      cursor: pointer; position: relative; overflow: hidden; transition: 0.1s;
    }
    .opt-btn:active { background: rgba(255,255,255,0.2); transform: scale(0.95); }
    .opt-btn.correct { background: var(--neon-green); color: #000; border-color: var(--neon-green); }
    .opt-btn.wrong { background: var(--neon-red); border-color: var(--neon-red); animation: shake 0.3s; }

    /* EFEKTLER */
    .explosion {
      position: absolute; width: 100px; height: 100px; 
      background: radial-gradient(circle, #fff, #ffaa00, transparent);
      border-radius: 50%; transform: scale(0); opacity: 1; pointer-events: none; z-index: 20;
    }
    .screen-shake { animation: shake 0.5s; }

    @keyframes shake { 0%, 100% {transform:translateX(0)} 25% {transform:translateX(-10px)} 75% {transform:translateX(10px)} }
    @keyframes laserShot { 0% {height:0; opacity:1;} 50% {height:100vh; opacity:1;} 100% {height:100vh; opacity:0;} }
    @keyframes explode { 0% {transform:scale(0); opacity:1;} 50% {transform:scale(1.5); opacity:0.8;} 100% {transform:scale(2); opacity:0;} }

    /* MODAL */
    .modal-wrap { position: absolute; inset: 0; background: rgba(0,0,0,0.9); z-index: 99; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(10px); }
    .modal-card { width: 85%; max-width: 320px; background: #101015; border: 1px solid var(--neon-blue); border-radius: 20px; padding: 25px; text-align: center; }
    .btn-main { width: 100%; padding: 15px; margin-top: 15px; background: var(--neon-blue); border: none; border-radius: 12px; font-weight: 800; font-size: 16px; cursor: pointer; color:#000; text-transform: uppercase; }
    
    .lang-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; margin-top: 15px; }
    .lang-btn { padding: 10px 0; background: rgba(255,255,255,0.1); border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: bold; border: 1px solid rgba(255,255,255,0.2); }
    .lang-btn.active { background: var(--neon-blue); color: #000; }

    .hidden { display: none !important; }
  </style>
</head>
<body>

  <div class="space-bg"></div>
  <div class="stars"></div>

  <div class="game-container" id="gameContainer">
    <div class="header">
      <div class="back-btn" onclick="location.href='/pages/game.html'">‚Üê</div>
      <div class="score-board"><span id="scoreVal">0</span> P</div>
      <div class="lives" id="livesVal">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
    </div>

    <div class="stage" id="stage">
      <div class="turret-base"></div>
      </div>

    <div class="control-panel">
      <div style="text-align:center; font-size:12px; opacity:0.5; margin-bottom:5px;">HEDEFƒ∞ SE√á & ATE≈ûLE</div>
      <div class="options-grid" id="optionsGrid">
        <button class="opt-btn">-</button>
        <button class="opt-btn">-</button>
        <button class="opt-btn">-</button>
        <button class="opt-btn">-</button>
      </div>
    </div>
  </div>

  <div class="modal-wrap" id="startModal">
    <div class="modal-card">
      <h2 style="color:var(--neon-blue); font-family:'Space Grotesk'">METEOR YAƒûMURU</h2>
      <p style="font-size:13px; opacity:0.7">Kelimeler d√º≈ümeden √∂nce anlamƒ±nƒ± bul ve vur! ‚òÑÔ∏èüî´</p>
      
      <div style="margin-top:15px; font-size:12px; font-weight:700">Dƒ∞L SE√á:</div>
      <div class="lang-grid">
        <div class="lang-btn active" onclick="selectLang('en', this)">EN</div>
        <div class="lang-btn" onclick="selectLang('de', this)">DE</div>
        <div class="lang-btn" onclick="selectLang('fr', this)">FR</div>
        <div class="lang-btn" onclick="selectLang('es', this)">ES</div>
        <div class="lang-btn" onclick="selectLang('it', this)">IT</div>
      </div>

      <button class="btn-main" onclick="startGame()">SAVUNMAYA BA≈ûLA</button>
    </div>
  </div>

  <div class="modal-wrap hidden" id="endModal">
    <div class="modal-card">
      <h2 style="color:var(--neon-red)">OYUN Bƒ∞TTƒ∞</h2>
      <div style="font-size:32px; font-weight:800; color:#fff; margin:10px 0" id="finalScore">0</div>
      <p style="opacity:0.7; font-size:13px">D√ºnya seninle gurur duyuyor.</p>
      <button class="btn-main" onclick="retryGame()">YENƒ∞DEN OYNA</button>
      <button class="btn-main" style="background:transparent; border:1px solid #fff; color:#fff" onclick="location.href='/pages/game.html'">√áIKI≈û</button>
    </div>
  </div>

<script>
// --- VERƒ∞TABANI (OFFLINE DB) ---
const DB = {
  en: [["Apple","Elma"],["Run","Ko≈ümak"],["Blue","Mavi"],["Car","Araba"],["Sun","G√ºne≈ü"],["Moon","Ay"],["Star","Yƒ±ldƒ±z"],["Water","Su"],["Fire","Ate≈ü"],["Tree","Aƒüa√ß"],["Book","Kitap"],["Computer","Bilgisayar"],["Love","A≈ük"],["Money","Para"],["Time","Zaman"],["Friend","Arkada≈ü"],["House","Ev"],["Door","Kapƒ±"],["Window","Pencere"],["School","Okul"]],
  de: [["Apfel","Elma"],["Laufen","Ko≈ümak"],["Blau","Mavi"],["Auto","Araba"],["Sonne","G√ºne≈ü"],["Mond","Ay"],["Stern","Yƒ±ldƒ±z"],["Wasser","Su"],["Feuer","Ate≈ü"],["Baum","Aƒüa√ß"],["Buch","Kitap"],["Computer","Bilgisayar"],["Liebe","A≈ük"],["Geld","Para"],["Zeit","Zaman"],["Freund","Arkada≈ü"],["Haus","Ev"],["T√ºr","Kapƒ±"],["Fenster","Pencere"],["Schule","Okul"]],
  fr: [["Pomme","Elma"],["Courir","Ko≈ümak"],["Bleu","Mavi"],["Voiture","Araba"],["Soleil","G√ºne≈ü"],["Lune","Ay"],["√âtoile","Yƒ±ldƒ±z"],["Eau","Su"],["Feu","Ate≈ü"],["Arbre","Aƒüa√ß"],["Livre","Kitap"],["Ordinateur","Bilgisayar"],["Amour","A≈ük"],["Argent","Para"],["Temps","Zaman"],["Ami","Arkada≈ü"],["Maison","Ev"],["Porte","Kapƒ±"],["Fen√™tre","Pencere"],["√âcole","Okul"]],
  es: [["Manzana","Elma"],["Correr","Ko≈ümak"],["Azul","Mavi"],["Coche","Araba"],["Sol","G√ºne≈ü"],["Luna","Ay"],["Estrella","Yƒ±ldƒ±z"],["Agua","Su"],["Fuego","Ate≈ü"],["√Årbol","Aƒüa√ß"],["Libro","Kitap"],["Ordenador","Bilgisayar"],["Amor","A≈ük"],["Dinero","Para"],["Tiempo","Zaman"],["Amigo","Arkada≈ü"],["Casa","Ev"],["Puerta","Kapƒ±"],["Ventana","Pencere"],["Escuela","Okul"]],
  it: [["Mela","Elma"],["Correre","Ko≈ümak"],["Blu","Mavi"],["Macchina","Araba"],["Sole","G√ºne≈ü"],["Luna","Ay"],["Stella","Yƒ±ldƒ±z"],["Acqua","Su"],["Fuoco","Ate≈ü"],["Albero","Aƒüa√ß"],["Libro","Kitap"],["Computer","Bilgisayar"],["Amore","A≈ük"],["Soldi","Para"],["Tempo","Zaman"],["Amico","Arkada≈ü"],["Casa","Ev"],["Porta","Kapƒ±"],["Finestra","Pencere"],["Scuola","Okul"]]
};

// --- STATE ---
let currentLang = 'en';
let score = 0;
let lives = 3;
let gameActive = false;
let meteorSpeed = 1.0; // D√º≈ü√º≈ü hƒ±zƒ±
let spawnInterval = 3000;
let lastSpawnTime = 0;
let activeMeteor = null; // { el, data: [word, meaning], y: 0 }
let frameId;

// --- INIT ---
function selectLang(l, btn) {
  currentLang = l;
  document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
}

function startGame() {
  document.getElementById('startModal').classList.add('hidden');
  document.getElementById('endModal').classList.add('hidden');
  
  score = 0;
  lives = 3;
  meteorSpeed = 0.8; 
  spawnInterval = 2500;
  activeMeteor = null;
  gameActive = true;
  
  updateUI();
  document.getElementById('stage').innerHTML = '<div class="turret-base"></div>'; // Temizle
  
  requestAnimationFrame(gameLoop);
  spawnMeteor(); // ƒ∞lk meteor hemen gelsin
}

function retryGame() {
  // Dil se√ßimine d√∂nmeden direkt ba≈ülat
  startGame();
}

// --- GAME LOOP ---
function gameLoop(timestamp) {
  if (!gameActive) return;

  // Meteor Hareketi
  if (activeMeteor) {
    activeMeteor.y += meteorSpeed;
    activeMeteor.el.style.top = activeMeteor.y + 'px';

    // √áarpƒ±≈üma Kontrol√º (Yere deƒüdi mi?)
    const stageH = document.getElementById('stage').offsetHeight;
    if (activeMeteor.y > stageH - 80) { // Taret hizasƒ±
      handleCrash();
    }
  } else {
    // Yeni Meteor Spawn (Eƒüer yoksa)
    // Basitlik i√ßin: Bir meteor yok olunca diƒüeri gelsin (Wave mantƒ±ƒüƒ±)
    // (Daha karma≈üƒ±k oyunlarda √ßoklu meteor olur ama mobilde tekil daha temiz)
    if (timestamp - lastSpawnTime > 500) { 
       // Biraz bekle √∂yle gelsin
    }
  }

  frameId = requestAnimationFrame(gameLoop);
}

// --- METEOR MANTIƒûI ---
function spawnMeteor() {
  if (activeMeteor) return;

  // Kelime Se√ß
  const pool = DB[currentLang];
  const wordPair = pool[Math.floor(Math.random() * pool.length)]; // ["Apple", "Elma"]
  
  // DOM Olu≈ütur
  const el = document.createElement('div');
  el.className = 'meteor';
  el.innerHTML = `
    <div class="meteor-tail"></div>
    <div class="meteor-body">
      <div class="meteor-text">${wordPair[0]}</div>
    </div>
  `;
  
  // Rastgele X pozisyonu (Ekran dƒ±≈üƒ±na ta≈ümasƒ±n)
  const stageW = document.getElementById('stage').offsetWidth;
  const randX = Math.random() * (stageW - 120) + 10;
  el.style.left = randX + 'px';
  
  document.getElementById('stage').appendChild(el);

  activeMeteor = {
    el: el,
    data: wordPair,
    y: -100,
    x: randX
  };

  setupOptions(wordPair);
  lastSpawnTime = performance.now();
  
  // Hƒ±z Artƒ±≈üƒ±
  meteorSpeed += 0.05;
}

// --- SE√áENEKLER ---
function setupOptions(correctPair) {
  const opts = [correctPair[1]]; // Doƒüru cevap
  const pool = DB[currentLang];
  
  // 3 Yanlƒ±≈ü Cevap Ekle
  while (opts.length < 4) {
    const r = pool[Math.floor(Math.random() * pool.length)][1];
    if (!opts.includes(r)) opts.push(r);
  }
  
  // Karƒ±≈ütƒ±r
  opts.sort(() => Math.random() - 0.5);
  
  const grid = document.getElementById('optionsGrid');
  grid.innerHTML = '';
  
  opts.forEach(opt => {
    const btn = document.createElement('button');
    btn.className = 'opt-btn';
    btn.innerText = opt;
    btn.onclick = () => checkAnswer(btn, opt, correctPair[1]);
    grid.appendChild(btn);
  });
}

function checkAnswer(btn, selected, correct) {
  if (!gameActive || !activeMeteor) return;

  if (selected === correct) {
    // DOƒûRU: ATE≈û ET!
    btn.classList.add('correct');
    fireLaser(activeMeteor.x + 50, activeMeteor.y + 50); // Meteor merkezine ate≈ü
    destroyMeteor();
    score += 10;
    speak(activeMeteor.data[0]); // Kelimeyi oku
  } else {
    // YANLI≈û
    btn.classList.add('wrong');
    playSFX('error');
    // Hƒ±z cezasƒ± verilebilir
  }
  updateUI();
}

// --- EFEKTLER ---
function fireLaser(targetX, targetY) {
  const stage = document.getElementById('stage');
  const stageH = stage.offsetHeight;
  const stageW = stage.offsetWidth;
  
  // Lazer √áizgisi (Basit DOM transform ile)
  // Taretin konumu: Bottom center
  const startX = stageW / 2;
  const startY = stageH; 
  
  const dx = targetX - startX;
  const dy = targetY - startY;
  const dist = Math.sqrt(dx*dx + dy*dy);
  const angle = Math.atan2(dy, dx) * 180 / Math.PI;

  const laser = document.createElement('div');
  laser.className = 'laser-beam';
  laser.style.height = '4px';
  laser.style.width = dist + 'px';
  laser.style.left = startX + 'px';
  laser.style.top = startY + 'px';
  laser.style.transform = `rotate(${angle}deg)`;
  laser.style.transformOrigin = '0 50%'; // Soldan d√∂n
  
  stage.appendChild(laser);
  playSFX('laser');

  // Lazer animasyonu
  setTimeout(() => laser.remove(), 200);
}

function destroyMeteor() {
  if (!activeMeteor) return;
  
  // Patlama Efekti
  const exp = document.createElement('div');
  exp.className = 'explosion';
  exp.style.left = (activeMeteor.x) + 'px';
  exp.style.top = (activeMeteor.y) + 'px';
  exp.style.animation = 'explode 0.4s forwards';
  document.getElementById('stage').appendChild(exp);
  playSFX('explode');

  activeMeteor.el.remove();
  activeMeteor = null;
  
  // Yeni meteor g√∂nder
  setTimeout(spawnMeteor, 500);
}

function handleCrash() {
  playSFX('crash');
  document.getElementById('gameContainer').classList.add('screen-shake');
  setTimeout(() => document.getElementById('gameContainer').classList.remove('screen-shake'), 500);
  
  activeMeteor.el.remove();
  activeMeteor = null;
  lives--;
  updateUI();

  if (lives <= 0) {
    gameOver();
  } else {
    setTimeout(spawnMeteor, 1000);
  }
}

function gameOver() {
  gameActive = false;
  cancelAnimationFrame(frameId);
  document.getElementById('endModal').classList.remove('hidden');
  document.getElementById('finalScore').innerText = score;
}

function updateUI() {
  document.getElementById('scoreVal').innerText = score;
  let h = "";
  for(let i=0; i<3; i++) h += (i < lives ? "‚ù§Ô∏è" : "üíÄ");
  document.getElementById('livesVal').innerText = h;
}

// --- SES MOTORU ---
const synth = window.speechSynthesis;
let audioCtx = new (window.AudioContext || window.webkitAudioContext)();

function playSFX(type) {
  if (audioCtx.state === 'suspended') audioCtx.resume();
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc.connect(gain);
  gain.connect(audioCtx.destination);

  const t = audioCtx.currentTime;

  if (type === 'laser') {
    osc.frequency.setValueAtTime(800, t);
    osc.frequency.exponentialRampToValueAtTime(100, t + 0.15);
    osc.type = 'sawtooth';
    gain.gain.setValueAtTime(0.1, t);
    gain.gain.linearRampToValueAtTime(0, t + 0.15);
    osc.start(t); osc.stop(t + 0.15);
  } else if (type === 'explode') {
    osc.frequency.setValueAtTime(100, t);
    osc.frequency.exponentialRampToValueAtTime(0.01, t + 0.3);
    osc.type = 'square';
    gain.gain.setValueAtTime(0.2, t);
    gain.gain.linearRampToValueAtTime(0, t + 0.3);
    osc.start(t); osc.stop(t + 0.3);
  } else if (type === 'error') {
    osc.type = 'sawtooth';
    osc.frequency.value = 150;
    gain.gain.value = 0.2;
    osc.start(t); osc.stop(t + 0.2);
  } else if (type === 'crash') {
    // G√ºr√ºlt√º sim√ºlasyonu i√ßin d√º≈ü√ºk frekans
    osc.frequency.value = 50;
    osc.type = 'sawtooth';
    gain.gain.setValueAtTime(0.5, t);
    gain.gain.linearRampToValueAtTime(0, t + 0.5);
    osc.start(t); osc.stop(t + 0.5);
  }
}

function speak(text) {
  const u = new SpeechSynthesisUtterance(text);
  const langMap = { 'en': 'en-US', 'de': 'de-DE', 'fr': 'fr-FR', 'es': 'es-ES', 'it': 'it-IT' };
  u.lang = langMap[currentLang] || 'en-US';
  synth.speak(u);
}

</script>
</body>
</html>
