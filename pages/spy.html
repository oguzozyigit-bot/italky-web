<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>ITALKY ‚Ä¢ Audio Spy</title>
  <link rel="icon" href="data:," />
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;700;800&family=Share+Tech+Mono&display=swap" rel="stylesheet">
  <style>
    /* --- TEMA: SPY RADAR --- */
    :root {
      --bg-deep: #000900;
      --radar: #00ffcc; /* Radar Cyan */
      --radar-dim: rgba(0, 255, 204, 0.15);
      --alert: #ff3300;
      --text: #e0fffb;
      --border: rgba(0, 255, 204, 0.3);
    }

    * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; outline: none; }
    html, body { margin: 0; width: 100%; height: 100%; overflow: hidden; position: fixed; font-family: 'Outfit', sans-serif; background: var(--bg-deep); color: var(--text); display: flex; align-items: center; justify-content: center; }

    /* Radar Arka Plan */
    .bg-radar {
      position: absolute; inset: -50%; width: 200%; height: 200%;
      background-image: 
        radial-gradient(var(--border) 1px, transparent 1px),
        radial-gradient(var(--border) 1px, transparent 1px);
      background-size: 60px 60px;
      background-position: 0 0, 30px 30px;
      opacity: 0.1;
      animation: rotateBg 60s linear infinite;
      z-index: 0;
    }
    @keyframes rotateBg { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

    .mobile-frame {
      width: 100%; max-width: 480px; height: 100%; position: relative; z-index: 10;
      display: flex; flex-direction: column; background: rgba(0, 15, 10, 0.9);
      backdrop-filter: blur(15px); border: 1px solid var(--border); overflow: hidden;
      box-shadow: 0 0 50px rgba(0, 255, 204, 0.1);
    }
    @media(min-width: 520px) { .mobile-frame { height: 92vh; border-radius: 20px; } }

    /* HEADER */
    .header { flex: 0 0 70px; padding: 0 20px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid var(--border); background: rgba(0,0,0,0.3); }
    .nav-btn { width: 40px; height: 40px; border-radius: 50%; background: var(--radar-dim); border: 1px solid var(--border); color: var(--radar); display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.2s; }
    .nav-btn:active { background: var(--radar); color: #000; transform: scale(0.9); }
    
    .page-title { font-family: 'Share Tech Mono', monospace; font-size: 20px; letter-spacing: 2px; color: var(--radar); text-shadow: 0 0 8px var(--radar); }
    .lang-badge { font-size: 10px; padding: 2px 6px; background: var(--radar); color: #000; border-radius: 2px; margin-left: 8px; font-weight: bold; }

    /* OYUN ALANI */
    .game-area { flex: 1; padding: 20px; display: flex; flex-direction: column; align-items: center; justify-content: space-between; }

    /* RADAR / SES G√ñRSELƒ∞ */
    .visualizer {
      width: 200px; height: 200px;
      border: 2px solid var(--border);
      border-radius: 50%;
      position: relative;
      display: flex; align-items: center; justify-content: center;
      background: radial-gradient(circle, rgba(0,255,204,0.1) 0%, transparent 70%);
      box-shadow: 0 0 30px var(--radar-dim);
      margin-top: 20px;
    }
    /* D√∂nen Tarayƒ±cƒ± */
    .scan-line {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      border-radius: 50%;
      background: conic-gradient(from 0deg, transparent 0deg, rgba(0,255,204,0.1) 60deg, var(--radar) 360deg);
      opacity: 0.1;
      animation: scan 4s linear infinite;
    }
    @keyframes scan { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

    /* Ses Dalgalarƒ± */
    .wave-bars { display: flex; gap: 4px; align-items: center; height: 60px; z-index: 2; }
    .bar { width: 6px; background: var(--radar); height: 10px; border-radius: 3px; transition: 0.1s; }
    .playing .bar { animation: equalize 0.5s infinite ease-in-out alternate; }
    .bar:nth-child(1) { animation-delay: 0.1s; } .bar:nth-child(2) { animation-delay: 0.3s; }
    .bar:nth-child(3) { animation-delay: 0.0s; } .bar:nth-child(4) { animation-delay: 0.4s; }
    .bar:nth-child(5) { animation-delay: 0.2s; }
    @keyframes equalize { 0% { height: 10px; opacity: 0.5; } 100% { height: 50px; opacity: 1; box-shadow: 0 0 10px var(--radar); } }

    /* Dƒ∞NLE BUTONU */
    .listen-btn {
      margin-top: -30px; z-index: 5;
      padding: 12px 30px;
      background: var(--bg-deep); border: 2px solid var(--radar);
      color: var(--radar); font-family: 'Share Tech Mono', monospace; font-size: 16px;
      border-radius: 30px; cursor: pointer; letter-spacing: 1px;
      display: flex; align-items: center; gap: 10px;
      box-shadow: 0 0 15px var(--radar-dim); transition: 0.2s;
    }
    .listen-btn:active { transform: scale(0.95); background: var(--radar); color: #000; }

    /* SE√áENEKLER */
    .options-list { width: 100%; display: flex; flex-direction: column; gap: 12px; margin-bottom: 20px; }
    .option-card {
      background: rgba(0, 40, 30, 0.6);
      border: 1px solid var(--border);
      padding: 16px; border-radius: 12px;
      color: #fff; font-size: 15px; font-weight: 500;
      cursor: pointer; transition: 0.2s; position: relative; overflow: hidden;
    }
    .option-card:active { background: rgba(0, 255, 204, 0.1); transform: scale(0.98); }
    
    .option-card.correct { border-color: #00e676; background: rgba(0, 230, 118, 0.2); color: #00e676; }
    .option-card.wrong { border-color: #ff1744; background: rgba(255, 23, 68, 0.2); color: #ff1744; }

    /* STATS */
    .stats-bar { width: 100%; display: flex; justify-content: space-between; padding: 0 10px; font-family: 'Share Tech Mono', monospace; color: var(--radar); opacity: 0.8; font-size: 12px; }

    /* MODAL */
    .modal-wrap { position: absolute; inset: 0; background: rgba(0,0,0,0.95); z-index: 99; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(10px); }
    .modal-card { width: 85%; max-width: 320px; background: #001510; border: 1px solid var(--radar); padding: 30px; text-align: center; border-radius: 16px; box-shadow: 0 0 40px var(--radar-dim); }
    
    .lang-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; margin-top: 20px; }
    .lang-btn {
      background: rgba(0,255,204,0.1); border: 1px solid var(--radar); color: var(--radar);
      padding: 10px 0; border-radius: 6px; font-family: 'Share Tech Mono', monospace; font-weight: bold;
      cursor: pointer; transition: 0.2s;
    }
    .lang-btn:active, .lang-btn:hover { background: var(--radar); color: #000; }

    .btn-main {
      width: 100%; padding: 15px; margin-top: 20px;
      background: var(--radar); color: #000; font-weight: 900; font-size: 16px;
      border: none; border-radius: 8px; cursor: pointer; text-transform: uppercase; font-family: 'Share Tech Mono', monospace;
      box-shadow: 0 0 20px rgba(0,255,204,0.4);
    }
    .btn-sec { background: transparent; border: 1px solid var(--radar); color: var(--radar); margin-top: 10px; box-shadow: none; }

    .hidden { display: none !important; }
  </style>
</head>
<body>

  <div class="bg-radar"></div>

  <div class="mobile-frame">
    <div class="header">
      <div class="nav-btn" onclick="location.href='/pages/game.html'">‚Üê</div>
      <div class="page-title">AUDIO_SPY <span id="langBadge" class="lang-badge">EN</span></div>
      <div class="nav-btn" onclick="toggleSound()" id="soundIcon">üîä</div>
    </div>

    <div class="game-area" id="gameScreen" style="display:none">
      
      <div class="visualizer" onclick="playCurrentAudio()">
        <div class="scan-line"></div>
        <div class="wave-bars" id="waveBars">
          <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
        </div>
      </div>

      <button class="listen-btn" onclick="playCurrentAudio()">
        <span>‚ñ∂</span> Sƒ∞NYALƒ∞ Dƒ∞NLE
      </button>

      <div style="flex:1"></div>

      <div class="options-list" id="optionsArea">
        </div>

      <div class="stats-bar">
        <span>SIGNAL: <span id="scoreVal">0</span>%</span>
        <span>LIVES: <span id="livesVal">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span></span>
      </div>
    </div>
  </div>

  <div class="modal-wrap" id="startModal">
    <div class="modal-card">
      <h2 style="color:var(--radar); font-family:'Share Tech Mono'; margin:0">INCOMING SIGNAL</h2>
      <p style="color:#fff; opacity:0.7; font-size:13px; margin-top:10px">Telsizden gelen ≈üifreli mesajƒ± dinle ve doƒüru anlamƒ± √ß√∂z.</p>
      
      <div class="lang-grid">
        <div class="lang-btn" onclick="selectLang('en')">EN</div>
        <div class="lang-btn" onclick="selectLang('de')">DE</div>
        <div class="lang-btn" onclick="selectLang('fr')">FR</div>
        <div class="lang-btn" onclick="selectLang('es')">ES</div>
        <div class="lang-btn" onclick="selectLang('it')">IT</div>
      </div>
    </div>
  </div>

  <div class="modal-wrap hidden" id="endModal">
    <div class="modal-card">
      <h2 id="endTitle" style="color:var(--alert); font-family:'Share Tech Mono'">SIGNAL LOST</h2>
      <div id="endDesc" style="color:#fff; opacity:0.9; margin:15px 0; font-size:14px;">...</div>
      
      <button class="btn-main" onclick="restartGame()">RECONNECT</button>
      <button class="btn-main btn-sec" onclick="location.href='/pages/game.html'">ABORT</button>
    </div>
  </div>

<script>
// --- OFFLINE DATABASE (Dinleme Odaklƒ± C√ºmleler) ---
// Yapƒ±: [Yabancƒ± C√ºmle (Duyulacak), T√ºrk√ße Anlamƒ± (≈ûƒ±k)]
const SPY_DB = {
  en: [
    ["Where is the nearest hospital?", "En yakƒ±n hastane nerede?"],
    ["Can you help me please?", "Bana yardƒ±m edebilir misin?"],
    ["I would like a cup of coffee.", "Bir fincan kahve istiyorum."],
    ["What time is it?", "Saat ka√ß?"],
    ["Nice to meet you.", "Tanƒ±≈ütƒ±ƒüƒ±mƒ±za memnun oldum."],
    ["How much does this cost?", "Bunun fiyatƒ± ne kadar?"],
    ["The weather is beautiful today.", "Bug√ºn hava √ßok g√ºzel."],
    ["I am looking for the train station.", "Tren istasyonunu arƒ±yorum."],
    ["Do you speak English?", "ƒ∞ngilizce konu≈üuyor musun?"],
    ["I don't understand.", "Anlamƒ±yorum."],
    ["Where is the bathroom?", "Tuvalet nerede?"],
    ["My name is Bond.", "Benim adƒ±m Bond."],
    ["Stop the car right now.", "Arabayƒ± hemen durdur."],
    ["We need more time.", "Daha fazla zamana ihtiyacƒ±mƒ±z var."],
    ["Mission accomplished.", "G√∂rev tamamlandƒ±."]
  ],
  de: [
    ["Wo ist das n√§chste Krankenhaus?", "En yakƒ±n hastane nerede?"],
    ["K√∂nnen Sie mir helfen?", "Bana yardƒ±m edebilir misiniz?"],
    ["Ich h√§tte gerne einen Kaffee.", "Bir kahve istiyorum."],
    ["Wie sp√§t ist es?", "Saat ka√ß?"],
    ["Freut mich, Sie kennenzulernen.", "Tanƒ±≈ütƒ±ƒüƒ±mƒ±za memnun oldum."],
    ["Wie viel kostet das?", "Bu ne kadar?"],
    ["Das Wetter ist heute sch√∂n.", "Bug√ºn hava g√ºzel."],
    ["Ich suche den Bahnhof.", "Tren istasyonunu arƒ±yorum."],
    ["Sprechen Sie Deutsch?", "Almanca konu≈üuyor musunuz?"],
    ["Ich verstehe nicht.", "Anlamƒ±yorum."]
  ],
  fr: [
    ["O√π est l'h√¥pital le plus proche ?", "En yakƒ±n hastane nerede?"],
    ["Pouvez-vous m'aider ?", "Bana yardƒ±m edebilir misiniz?"],
    ["Je voudrais un caf√©.", "Bir kahve istiyorum."],
    ["Quelle heure est-il ?", "Saat ka√ß?"],
    ["Enchant√© de vous rencontrer.", "Tanƒ±≈ütƒ±ƒüƒ±mƒ±za memnun oldum."],
    ["Combien √ßa co√ªte ?", "Bu ne kadar?"],
    ["Il fait beau aujourd'hui.", "Bug√ºn hava g√ºzel."],
    ["Je cherche la gare.", "Tren istasyonunu arƒ±yorum."],
    ["Parlez-vous fran√ßais ?", "Fransƒ±zca konu≈üuyor musunuz?"],
    ["Je ne comprends pas.", "Anlamƒ±yorum."]
  ],
  es: [
    ["¬øD√≥nde est√° el hospital m√°s cercano?", "En yakƒ±n hastane nerede?"],
    ["¬øPuede ayudarme?", "Bana yardƒ±m edebilir misiniz?"],
    ["Quiero un caf√©.", "Bir kahve istiyorum."],
    ["¬øQu√© hora es?", "Saat ka√ß?"],
    ["Mucho gusto.", "Tanƒ±≈ütƒ±ƒüƒ±mƒ±za memnun oldum."],
    ["¬øCu√°nto cuesta esto?", "Bu ne kadar?"],
    ["El tiempo es bueno hoy.", "Bug√ºn hava g√ºzel."],
    ["Busco la estaci√≥n de tren.", "Tren istasyonunu arƒ±yorum."],
    ["¬øHablas espa√±ol?", "ƒ∞spanyolca konu≈üuyor musun?"],
    ["No entiendo.", "Anlamƒ±yorum."]
  ],
  it: [
    ["Dov'√® l'ospedale pi√π vicino?", "En yakƒ±n hastane nerede?"],
    ["Puoi aiutarmi?", "Bana yardƒ±m edebilir misin?"],
    ["Vorrei un caff√®.", "Bir kahve istiyorum."],
    ["Che ore sono?", "Saat ka√ß?"],
    ["Piacere di conoscerti.", "Tanƒ±≈ütƒ±ƒüƒ±mƒ±za memnun oldum."],
    ["Quanto costa?", "Bu ne kadar?"],
    ["Il tempo √® bello oggi.", "Bug√ºn hava g√ºzel."],
    ["Cerco la stazione ferroviaria.", "Tren istasyonunu arƒ±yorum."],
    ["Parli italiano?", "ƒ∞talyanca konu≈üuyor musun?"],
    ["Non capisco.", "Anlamƒ±yorum."]
  ]
};

// --- STATE ---
let currentLang = 'en';
let currentItem = null; // ["Hello", "Merhaba"]
let score = 0;
let lives = 3;
let isMuted = false;
let isPlaying = false;

// --- Dƒ∞L SE√áƒ∞Mƒ∞ ---
function selectLang(l) {
  currentLang = l;
  document.getElementById('langBadge').innerText = l.toUpperCase();
  document.getElementById('startModal').style.display = 'none';
  document.getElementById('gameScreen').style.display = 'flex';
  
  restartGame();
}

// --- OYUN BA≈ûLATMA ---
function restartGame() {
  document.getElementById('endModal').classList.add('hidden');
  score = 0;
  lives = 3;
  updateStats();
  
  // Karƒ±≈ütƒ±r
  if(SPY_DB[currentLang]) SPY_DB[currentLang].sort(() => Math.random() - 0.5);
  
  loadLevel();
}

// --- SEVƒ∞YE Y√úKLEME ---
function loadLevel() {
  // Rastgele bir soru se√ß
  const pool = SPY_DB[currentLang] || SPY_DB.en;
  currentItem = pool[Math.floor(Math.random() * pool.length)];
  
  // ≈ûƒ±klarƒ± olu≈ütur (1 Doƒüru + 3 Yanlƒ±≈ü)
  const options = [currentItem[1]];
  while (options.length < 4) {
    const randomItem = pool[Math.floor(Math.random() * pool.length)];
    if (!options.includes(randomItem[1])) {
      options.push(randomItem[1]);
    }
  }
  options.sort(() => Math.random() - 0.5); // ≈ûƒ±klarƒ± karƒ±≈ütƒ±r

  renderOptions(options);
  
  // Otomatik oynat (kƒ±sa gecikme ile)
  setTimeout(playCurrentAudio, 500);
}

function renderOptions(options) {
  const area = document.getElementById('optionsArea');
  area.innerHTML = '';
  
  options.forEach(opt => {
    const btn = document.createElement('div');
    btn.className = 'option-card';
    btn.innerText = opt;
    btn.onclick = () => checkAnswer(btn, opt);
    area.appendChild(btn);
  });
}

// --- SES OYNATMA (G√ñRSEL EFEKTLƒ∞) ---
function playCurrentAudio() {
  if (isPlaying) return;
  
  speak(currentItem[0]);
  
  // Animasyonu Ba≈ülat
  isPlaying = true;
  document.getElementById('waveBars').classList.add('playing');
  
  // Tahmini s√ºre sonra animasyonu durdur
  setTimeout(() => {
    isPlaying = false;
    document.getElementById('waveBars').classList.remove('playing');
  }, 2500);
}

// --- KONTROL ---
function checkAnswer(btn, selected) {
  if (selected === currentItem[1]) {
    // DOƒûRU
    btn.classList.add('correct');
    playSFX('success');
    score += 10; // %10 sinyal g√ºc√º
    
    setTimeout(() => {
      updateStats();
      loadLevel();
    }, 1000);
  } else {
    // YANLI≈û
    btn.classList.add('wrong');
    playSFX('error');
    lives--;
    updateStats();
    
    // Doƒüruyu g√∂ster
    document.querySelectorAll('.option-card').forEach(b => {
      if (b.innerText === currentItem[1]) b.classList.add('correct');
    });

    if (lives <= 0) {
      setTimeout(endGame, 1000);
    } else {
      setTimeout(loadLevel, 1500);
    }
  }
}

function updateStats() {
  document.getElementById('scoreVal').innerText = score;
  let h = "";
  for(let i=0; i<3; i++) h += (i < lives ? "‚ù§Ô∏è" : "üíÄ");
  document.getElementById('livesVal').innerText = h;
}

function endGame() {
  document.getElementById('endModal').classList.remove('hidden');
  document.getElementById('endDesc').innerHTML = `
    Baƒülantƒ± Ba≈üarƒ±sƒ±: <strong style="color:var(--radar)">%${score}</strong><br><br>
    Son Sinyal:<br>
    <span style="color:#fff; opacity:0.6">"${currentItem[0]}"</span><br>
    <strong style="color:#fff">${currentItem[1]}</strong>
  `;
}

// --- SES Sƒ∞STEMƒ∞ ---
const synth = window.speechSynthesis;
let audioCtx = new (window.AudioContext || window.webkitAudioContext)();

function toggleSound() {
  isMuted = !isMuted;
  document.getElementById('soundIcon').innerText = isMuted ? "üîá" : "üîä";
}

function playSFX(type) {
  if (isMuted) return;
  if (audioCtx.state === 'suspended') audioCtx.resume();
  
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc.connect(gain);
  gain.connect(audioCtx.destination);
  const t = audioCtx.currentTime;

  if (type === 'success') {
    osc.type = 'sine';
    osc.frequency.setValueAtTime(800, t);
    osc.frequency.linearRampToValueAtTime(1200, t + 0.1);
    gain.gain.setValueAtTime(0.1, t);
    gain.gain.linearRampToValueAtTime(0, t + 0.3);
    osc.start(t); osc.stop(t + 0.3);
  } else if (type === 'error') {
    osc.type = 'sawtooth';
    osc.frequency.setValueAtTime(150, t);
    osc.frequency.linearRampToValueAtTime(100, t + 0.2);
    gain.gain.setValueAtTime(0.2, t);
    gain.gain.linearRampToValueAtTime(0, t + 0.3);
    osc.start(t); osc.stop(t + 0.3);
  }
}

function speak(text) {
  if (isMuted) return;
  try {
    synth.cancel();
    const u = new SpeechSynthesisUtterance(text);
    const langMap = { 'en': 'en-US', 'de': 'de-DE', 'fr': 'fr-FR', 'es': 'es-ES', 'it': 'it-IT' };
    u.lang = langMap[currentLang] || 'en-US';
    u.rate = 0.9;
    synth.speak(u);
  } catch(e) {}
}

</script>
</body>
</html>
