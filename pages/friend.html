<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"/>
  <title>ITALKY ‚Ä¢ Friend Arena v2</title>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;700;900&family=Space+Grotesk:wght@700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg: #050508;
      --border: rgba(255,255,255,0.1);
      --p1: #00f3ff; /* Cyan - Oyuncu A */
      --p2: #ff0055; /* Magenta - Oyuncu B */
      --green: #00e676;
      --red: #ff1744;
    }

    * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; outline: none; }
    
    html, body {
      margin: 0; padding: 0; width: 100%; height: 100%;
      background: var(--bg); font-family: 'Outfit', sans-serif;
      color: #fff; overflow: hidden; position: fixed;
    }

    /* Arka Plan */
    .bg-fx {
      position: absolute; inset: 0; z-index: 0;
      background: radial-gradient(circle at 50% 50%, #1a1a2e 0%, #000 100%);
      opacity: 0.8;
    }

    /* OYUN ALANI */
    .arena-wrap {
      position: relative; z-index: 10;
      width: 100%; height: 100%;
      display: flex; flex-direction: column;
    }

    /* OYUNCU ALANLARI */
    .player-zone {
      flex: 1;
      position: relative;
      display: flex; flex-direction: column;
      justify-content: center; align-items: center;
      transition: background 0.3s;
    }
    
    /* Kritik D√ºzeltme 1: Zone'u deƒüil, i√ßindeki Content'i d√∂nd√ºreceƒüiz */
    #zoneB { border-bottom: 1px solid var(--border); }
    #zoneB .card-content { transform: rotate(180deg); } 
    
    #zoneA { border-top: 1px solid var(--border); }

    /* Aktif Oyuncu Efekti */
    .player-zone.active { background: rgba(255,255,255,0.03); }
    /* Glow efektleri */
    .player-zone::before {
      content:''; position:absolute; inset:0; pointer-events:none; opacity:0; transition:0.3s;
    }
    #zoneA.active::before { box-shadow: inset 0 -20px 60px rgba(0, 243, 255, 0.15); opacity:1; }
    #zoneB.active::before { box-shadow: inset 0 20px 60px rgba(255, 0, 85, 0.15); opacity:1; }

    /* ƒ∞√áERƒ∞K KARTI */
    .card-content {
      width: 80%; max-width: 320px;
      text-align: center;
      opacity: 0.4; 
      filter: blur(3px);
      transition: 0.4s ease;
      /* Kritik D√ºzeltme 2: Sƒ±ra onda deƒüilse tƒ±klayamaz */
      pointer-events: none; 
    }

    .player-zone.active .card-content {
      opacity: 1; filter: blur(0);
      pointer-events: auto;
      transform: scale(1.05);
    }
    /* ZoneB aktifken rotate korunsun ama scale gelsin */
    #zoneB.active .card-content { transform: rotate(180deg) scale(1.05); }

    .player-label {
      font-size: 11px; font-weight: 900; letter-spacing: 2px;
      margin-bottom: 15px; text-transform: uppercase;
      color: rgba(255,255,255,0.4);
    }
    #zoneA .player-label { color: var(--p1); }
    #zoneB .player-label { color: var(--p2); }

    .main-word { font-family: 'Space Grotesk', sans-serif; font-size: 32px; font-weight: 700; margin: 10px 0; line-height: 1.1; }
    .sub-word { font-size: 16px; color: rgba(255,255,255,0.6); margin-bottom: 25px; min-height: 20px;}

    /* BUTONLAR */
    .controls { display: flex; gap: 12px; justify-content: center; width: 100%; }
    
    .btn {
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.08);
      color: #fff; padding: 16px 0;
      border-radius: 16px; font-weight: 800; font-size: 13px;
      cursor: pointer; flex: 1;
      transition: 0.2s;
    }
    .btn:active { transform: scale(0.95); }
    .btn-mic { flex: 2; background: rgba(255,255,255,0.15); border-color: rgba(255,255,255,0.3); }
    
    #zoneA .btn-mic.listening { background: var(--p1); color: #000; box-shadow: 0 0 20px var(--p1); }
    #zoneB .btn-mic.listening { background: var(--p2); color: #fff; box-shadow: 0 0 20px var(--p2); }

    /* ORTA Bƒ∞LGƒ∞ */
    .arena-center {
      position: absolute; top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      width: 100px; height: 50px;
      background: #000; border: 1px solid var(--border);
      border-radius: 25px;
      display: flex; align-items: center; justify-content: center;
      z-index: 20;
      box-shadow: 0 0 30px #000;
    }
    .score-board { font-family: 'Space Grotesk'; font-size: 18px; font-weight: 700; display: flex; gap: 15px; }
    .score-a { color: var(--p1); }
    .score-b { color: var(--p2); }

    /* SONU√á OVERLAY (D√ºzeltme: HTML birikmesini √∂nlemek i√ßin yapƒ± deƒüi≈üti) */
    .overlay {
      position: absolute; inset: 0;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      background: rgba(0,0,0,0.85); backdrop-filter: blur(8px);
      z-index: 50; opacity: 0; pointer-events: none; transition: 0.2s;
    }
    .overlay.show { opacity: 1; } /* Sadece g√∂rsel, pointer-events hala none olabilir, JS ile y√∂netelim */
    
    /* ZoneB'deki overlay de ters d√∂nmeli */
    #zoneB .overlay { transform: rotate(180deg); }

    .overlay-text { font-size: 32px; font-weight: 900; text-transform: uppercase; margin-bottom: 5px; }
    .overlay-sub { font-size: 14px; color: #ccc; }
    
    .overlay.correct .overlay-text { color: var(--green); }
    .overlay.wrong .overlay-text { color: var(--red); }

    /* MODALLER */
    .modal {
      position: fixed; inset: 0; z-index: 100;
      background: rgba(0,0,0,0.95);
      display: flex; align-items: center; justify-content: center;
      backdrop-filter: blur(10px);
      transition: 0.3s;
    }
    .modal.hidden { opacity: 0; pointer-events: none; }
    
    .modal-box {
      width: 85%; max-width: 350px;
      background: #111; border: 1px solid var(--border);
      border-radius: 24px; padding: 30px 20px; text-align: center;
    }
    .modal-title { 
      font-family: 'Space Grotesk'; font-size: 28px; margin-bottom: 20px; 
      background: linear-gradient(90deg, var(--p1), var(--p2)); 
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; 
    }
    
    .lang-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; margin-bottom: 25px; }
    .lang-opt { font-size: 22px; padding: 12px 0; border-radius: 10px; border: 1px solid var(--border); cursor: pointer; transition:0.2s; }
    .lang-opt.selected { background: var(--p1); border-color: var(--p1); color: #000; transform: scale(1.1); }

    .btn-block { width: 100%; padding: 18px; margin-bottom: 12px; border-radius: 14px; border:none; font-weight:800; cursor:pointer; font-size: 15px; text-transform:uppercase; letter-spacing:1px; }
    .btn-pron { background: var(--p1); color: #000; }
    .btn-vocab { background: var(--p2); color: #fff; }
    .btn-restart { background: #333; color: #fff; border: 1px solid var(--border); }

  </style>
</head>
<body>

  <div class="bg-fx"></div>

  <div class="arena-wrap">
    
    <div class="player-zone" id="zoneB">
      <div class="overlay" id="overlayB">
        <div class="overlay-text"></div>
        <div class="overlay-sub"></div>
      </div>
      
      <div class="card-content">
        <div class="player-label">OYUNCU B</div>
        <div class="main-word" id="wordB">...</div>
        <div class="sub-word" id="meanB">...</div>
        <div class="controls">
          <button class="btn" onclick="game.pass()">PAS</button>
          <button class="btn btn-mic" id="btnMicB" onclick="game.listen('B')">üéôÔ∏è S√ñYLE</button>
        </div>
      </div>
    </div>

    <div class="arena-center">
      <div class="score-board">
        <span class="score-b" id="scoreBDisplay">0</span>
        <span style="opacity:0.3; font-size:14px; display:flex; align-items:center;">VS</span>
        <span class="score-a" id="scoreADisplay">0</span>
      </div>
    </div>

    <div class="player-zone" id="zoneA">
      <div class="overlay" id="overlayA">
        <div class="overlay-text"></div>
        <div class="overlay-sub"></div>
      </div>

      <div class="card-content">
        <div class="player-label">OYUNCU A</div>
        <div class="main-word" id="wordA">...</div>
        <div class="sub-word" id="meanA">...</div>
        <div class="controls">
          <button class="btn" onclick="game.pass()">PAS</button>
          <button class="btn btn-mic" id="btnMicA" onclick="game.listen('A')">üéôÔ∏è S√ñYLE</button>
        </div>
      </div>
    </div>

  </div>

  <div class="modal" id="startModal">
    <div class="modal-box">
      <div class="modal-title">ARENA SETUP</div>
      
      <div class="lang-grid">
        <div class="lang-opt selected" onclick="selectLang('en', this)">üá¨üáß</div>
        <div class="lang-opt" onclick="selectLang('de', this)">üá©üá™</div>
        <div class="lang-opt" onclick="selectLang('fr', this)">üá´üá∑</div>
        <div class="lang-opt" onclick="selectLang('es', this)">üá™üá∏</div>
        <div class="lang-opt" onclick="selectLang('it', this)">üáÆüáπ</div>
      </div>

      <button class="btn-block btn-pron" onclick="game.start('pronunciation')">TELAFFUZ Lƒ∞Gƒ∞</button>
      <button class="btn-block btn-vocab" onclick="game.start('vocabulary')">KELƒ∞ME Lƒ∞Gƒ∞</button>
    </div>
  </div>

  <div class="modal hidden" id="endModal">
    <div class="modal-box">
      <div class="modal-title">OYUN Bƒ∞TTƒ∞</div>
      <h1 id="winnerText" style="font-size:40px; margin:20px 0;">A KAZANDI</h1>
      <p id="finalScore" style="color:#888; margin-bottom:30px;">5 - 3</p>
      <button class="btn-block btn-restart" onclick="location.reload()">TEKRAR OYNA</button>
    </div>
  </div>

<script>
// --- DB (Daha Geni≈ü) ---
const DB = {
  en: [
    { w: "Excellent", tr: "M√ºkemmel" }, { w: "Decision", tr: "Karar" },
    { w: "Challenge", tr: "Meydan okuma" }, { w: "Opportunity", tr: "Fƒ±rsat" },
    { w: "Journey", tr: "Yolculuk" }, { w: "Environment", tr: "√áevre" },
    { w: "Development", tr: "Geli≈üim" }, { w: "Necessary", tr: "Gerekli" },
    { w: "Beautiful", tr: "G√ºzel" }, { w: "Dangerous", tr: "Tehlikeli" }
  ],
  de: [
    { w: "Entscheidung", tr: "Karar" }, { w: "M√∂glichkeit", tr: "ƒ∞mkan" },
    { w: "Erfahrung", tr: "Deneyim" }, { w: "Nat√ºrlich", tr: "Doƒüal" },
    { w: "Wichtig", tr: "√ñnemli" }, { w: "Zusammen", tr: "Birlikte" },
    { w: "Schmetterling", tr: "Kelebek" }, { w: "Gef√§hrlich", tr: "Tehlikeli" }
  ],
  fr: [
    { w: "Bonjour", tr: "Merhaba" }, { w: "Amour", tr: "A≈ük" },
    { w: "Voiture", tr: "Araba" }, { w: "Maison", tr: "Ev" },
    { w: "Magnifique", tr: "Muhte≈üem" }, { w: "Toujours", tr: "Her zaman" }
  ],
  es: [
    { w: "Corazon", tr: "Kalp" }, { w: "Amigo", tr: "Arkada≈ü" },
    { w: "Tiempo", tr: "Zaman" }, { w: "Vida", tr: "Hayat" },
    { w: "Felicidad", tr: "Mutluluk" }, { w: "Peligroso", tr: "Tehlikeli" }
  ],
  it: [
    { w: "Ciao", tr: "Merhaba" }, { w: "Grazie", tr: "Te≈üekk√ºrler" },
    { w: "Bella", tr: "G√ºzel" }, { w: "Notte", tr: "Gece" },
    { w: "Famiglia", tr: "Aile" }, { w: "Piccolo", tr: "K√º√ß√ºk" }
  ]
};

let selectedLang = 'en';

function selectLang(code, el) {
  selectedLang = code;
  document.querySelectorAll('.lang-opt').forEach(d => d.classList.remove('selected'));
  el.classList.add('selected');
}

const game = {
  mode: 'pronunciation',
  langCode: 'en-US',
  words: [],
  idx: 0,
  turn: 'A',
  scores: { A: 0, B: 0 },
  isListening: false,
  recognition: null,

  start: function(mode) {
    this.mode = mode;
    // D√ºzeltme: Lang kodu g√ºvenliƒüi
    const langMap = { en: 'en-US', de: 'de-DE', fr: 'fr-FR', es: 'es-ES', it: 'it-IT' };
    this.langCode = langMap[selectedLang] || 'en-US';
    
    // Kelimeleri y√ºkle ve karƒ±≈ütƒ±r
    this.words = DB[selectedLang] ? [...DB[selectedLang]] : [...DB['en']];
    this.words.sort(() => Math.random() - 0.5);
    
    this.idx = 0;
    this.scores = { A: 0, B: 0 };
    this.turn = Math.random() > 0.5 ? 'A' : 'B';
    
    document.getElementById('startModal').classList.add('hidden');
    this.updateUI();
    this.loadCard();
  },

  loadCard: function() {
    if (this.idx >= this.words.length) {
      this.endGame();
      return;
    }

    const item = this.words[this.idx];
    let mainTxt, subTxt;

    if (this.mode === 'pronunciation') {
      mainTxt = item.w;
      subTxt = item.tr;
    } else {
      mainTxt = item.tr;
      subTxt = "ƒ∞ngilizcesini s√∂yle"; // D√ºzeltme: Kullanƒ±cƒ±ya ne yapacaƒüƒ±nƒ± s√∂yle
    }

    // Ekranlarƒ± g√ºncelle
    document.getElementById('wordA').textContent = mainTxt;
    document.getElementById('meanA').textContent = subTxt;
    document.getElementById('wordB').textContent = mainTxt;
    document.getElementById('meanB').textContent = subTxt;
  },

  updateUI: function() {
    document.getElementById('scoreADisplay').textContent = this.scores.A;
    document.getElementById('scoreBDisplay').textContent = this.scores.B;

    document.getElementById('zoneA').classList.toggle('active', this.turn === 'A');
    document.getElementById('zoneB').classList.toggle('active', this.turn === 'B');
  },

  // D√ºzeltme: Text Normalizasyonu
  cleanText: function(text) {
    return text.toLowerCase()
      .replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g,"") // Noktalama sil
      .trim();
  },

  listen: function(player) {
    if (player !== this.turn) return;
    if (this.isListening) return;

    // TTS durdur (√áakƒ±≈üma √∂nlemi)
    window.speechSynthesis.cancel();

    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (!SpeechRecognition) { alert("Ses tanƒ±ma desteklenmiyor"); return; }

    this.recognition = new SpeechRecognition();
    // D√ºzeltme: Vocabulary modunda hedef dili dinlemeli, ekrandaki dili deƒüil
    this.recognition.lang = this.langCode; 
    this.recognition.interimResults = false;
    this.recognition.maxAlternatives = 1;

    this.isListening = true;
    const btn = document.getElementById(`btnMic${player}`);
    const originalText = btn.textContent;
    btn.textContent = "üëÇ...";
    btn.classList.add('listening');

    this.recognition.start();

    this.recognition.onresult = (event) => {
      const spoken = event.results[0][0].transcript;
      this.checkAnswer(spoken, player);
    };

    this.recognition.onerror = () => { this.stopListening(player, originalText); };
    this.recognition.onend = () => { this.stopListening(player, originalText); };
  },

  stopListening: function(player, originalText) {
    this.isListening = false;
    const btn = document.getElementById(`btnMic${player}`);
    btn.textContent = "üéôÔ∏è S√ñYLE"; // Sabit metne d√∂n
    btn.classList.remove('listening');
  },

  checkAnswer: function(rawSpoken, player) {
    // D√ºzeltme: Normalize edilmi≈ü kar≈üƒ±la≈ütƒ±rma
    const spoken = this.cleanText(rawSpoken);
    const target = this.cleanText(this.words[this.idx].w);

    // Tam e≈üle≈üme veya i√ßerme (esnek)
    const isCorrect = spoken === target || (target.length > 4 && spoken.includes(target));

    if (isCorrect) {
      this.scores[player]++;
      this.showFeedback(player, true);
      
      // Doƒüruysa seslendir
      this.speak(this.words[this.idx].w);
      
      setTimeout(() => this.nextTurn(), 1200);
    } else {
      this.showFeedback(player, false, this.words[this.idx].w);
      // Yanlƒ±≈üta seslendirme, √∂ƒürensin
      this.speak(this.words[this.idx].w);
      
      setTimeout(() => this.nextTurn(), 2000); // Yanlƒ±≈üta biraz daha bekle
    }
  },

  showFeedback: function(player, isCorrect, correctWord = "") {
    const el = document.getElementById(player === 'A' ? 'overlayA' : 'overlayB');
    const txtEl = el.querySelector('.overlay-text');
    const subEl = el.querySelector('.overlay-sub');

    el.className = `overlay show ${isCorrect ? 'correct' : 'wrong'}`;
    txtEl.textContent = isCorrect ? "HARƒ∞KA!" : "YANLI≈û";
    subEl.textContent = isCorrect ? "+1 PUAN" : `Doƒürusu: ${correctWord}`;

    setTimeout(() => {
      el.classList.remove('show');
    }, 1500);
  },

  pass: function() {
    if (this.isListening) return;
    this.speak(this.words[this.idx].w);
    this.nextTurn();
  },

  nextTurn: function() {
    this.idx++;
    this.turn = this.turn === 'A' ? 'B' : 'A';
    this.updateUI();
    this.loadCard();
  },

  speak: function(txt) {
    window.speechSynthesis.cancel(); // √ñncekini sustur
    const u = new SpeechSynthesisUtterance(txt);
    u.lang = this.langCode;
    window.speechSynthesis.speak(u);
  },

  endGame: function() {
    const modal = document.getElementById('endModal');
    const winnerText = document.getElementById('winnerText');
    const finalScore = document.getElementById('finalScore');
    
    modal.classList.remove('hidden');
    
    if (this.scores.A > this.scores.B) {
      winnerText.textContent = "A KAZANDI!";
      winnerText.style.color = "var(--p1)";
    } else if (this.scores.B > this.scores.A) {
      winnerText.textContent = "B KAZANDI!";
      winnerText.style.color = "var(--p2)";
    } else {
      winnerText.textContent = "BERABERE!";
      winnerText.style.color = "#fff";
    }
    
    finalScore.textContent = `A: ${this.scores.A} - B: ${this.scores.B}`;
  }
};
</script>
</body>
</html>
