<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ITALKY ‚Ä¢ Glitch Hunter ‚Äî Final</title>
<link rel="icon" href="data:,">
<link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Space+Grotesk:wght@700&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#050505; --cyan:#00ffff; --pink:#ff0055; --green:#00ff66;
  --panel:rgba(10,20,20,.95); --border:rgba(0,255,255,.3); --text:#e0fbfc;
}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent;user-select:none}
html,body{margin:0;width:100%;height:100%;overflow:hidden;background:var(--bg);
  font-family:'Share Tech Mono',monospace;color:var(--text)}
.matrix{position:absolute;inset:0;background:linear-gradient(180deg,rgba(0,255,255,.05),transparent,rgba(255,0,85,.05));
  background-size:100% 200%;animation:scan 5s linear infinite}
@keyframes scan{to{background-position:0 200%}}

.app{position:relative;max-width:480px;height:100%;margin:0 auto;
  background:var(--panel);border:1px solid var(--border);display:flex;flex-direction:column}
@media(min-width:520px){.app{height:92vh;border-radius:20px}}

.header{height:70px;display:flex;align-items:center;justify-content:space-between;padding:0 16px;
  border-bottom:1px solid var(--border)}
.btn{width:40px;height:40px;border:1px solid var(--cyan);background:rgba(0,255,255,.1);
  color:var(--cyan);display:flex;align-items:center;justify-content:center;cursor:pointer}
.title{font-size:20px;letter-spacing:2px;color:var(--cyan);text-shadow:2px 0 var(--pink)}
.badge{font-size:10px;padding:2px 6px;background:var(--cyan);color:#000;margin-left:6px}

.game{flex:1;padding:16px;display:none;flex-direction:column;justify-content:space-between}
.stats{display:flex;justify-content:space-between;font-size:14px;color:var(--cyan);opacity:.85}

.terminal{flex:1;border:2px solid var(--border);background:rgba(0,0,0,.6);
  display:flex;align-items:center;justify-content:center;position:relative;
  box-shadow:inset 0 0 30px rgba(0,255,255,.05)}
.term-head{position:absolute;top:0;left:0;right:0;height:24px;
  background:rgba(0,255,255,.1);border-bottom:1px solid var(--border);
  font-size:10px;padding:0 10px;display:flex;align-items:center}
.sentence{font-family:'Space Grotesk',sans-serif;font-size:24px;text-align:center;color:#fff}

.controls{display:flex;gap:16px;height:120px}
.action{flex:1;border:2px solid var(--border);cursor:pointer;font-size:18px;
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  transition:.15s}
.bug{border-color:var(--pink);color:var(--pink);background:rgba(255,0,85,.15)}
.ok{border-color:var(--green);color:var(--green);background:rgba(0,255,102,.15)}
.action:active{transform:scale(.95)}
.icon{font-size:38px}

.toast{position:absolute;bottom:150px;left:20px;right:20px;
  background:#000;border:1px solid #fff;padding:14px;display:none;gap:10px}
.toast.show{display:flex}
.toast.success{border-color:var(--green);color:var(--green)}
.toast.fail{border-color:var(--pink);color:var(--pink)}

.modal{position:absolute;inset:0;background:rgba(0,0,0,.95);
  display:flex;align-items:center;justify-content:center;z-index:50}
.card{background:#080808;border:1px solid var(--cyan);padding:26px;width:85%;text-align:center}
.langs{display:grid;grid-template-columns:repeat(5,1fr);gap:6px;margin-top:16px}
.lang{border:1px solid var(--cyan);color:var(--cyan);padding:10px;cursor:pointer}
.lang.active{background:var(--cyan);color:#000}
.mainbtn{width:100%;padding:14px;margin-top:16px;border:none;
  background:var(--cyan);color:#000;font-weight:900}

.hidden{display:none!important}
.glitch{animation:glitch .3s}
@keyframes glitch{
  20%{filter:hue-rotate(90deg);transform:translate(-5px,5px)}
  60%{filter:invert(1);transform:translate(5px,-5px)}
}
</style>
</head>

<body>
<div class="matrix"></div>

<div class="app" id="frame">
  <div class="header">
    <div class="btn" onclick="location.href='/pages/game.html'">‚Üê</div>
    <div class="title">GLITCH_HUNTER <span id="langBadge" class="badge">EN</span></div>
    <div class="btn" id="soundBtn">üîä</div>
  </div>

  <div class="game" id="game">
    <div class="stats">
      <span>SCORE: <b id="score">0</b></span>
      <span>INTEGRITY: <b id="life">100%</b></span>
    </div>

    <div class="terminal">
      <div class="term-head">/// SYSTEM_CHECK_V3.0 ///</div>
      <div class="sentence" id="sentence">...</div>
    </div>

    <div class="controls">
      <div class="action bug" onclick="answer(false)">
        <div class="icon">üêû</div>GLITCH
      </div>
      <div class="action ok" onclick="answer(true)">
        <div class="icon">üõ°Ô∏è</div>STABLE
      </div>
    </div>

    <div class="toast" id="toast">
      <div id="toastText"></div>
    </div>
  </div>
</div>

<div class="modal" id="start">
  <div class="card">
    <h2 style="color:var(--cyan)">SYSTEM BOOT</h2>
    <p style="opacity:.7">C√ºmlede hata var mƒ± tespit et.</p>
    <div class="langs">
      <div class="lang active" data-lang="en">EN</div>
      <div class="lang" data-lang="de">DE</div>
      <div class="lang" data-lang="fr">FR</div>
      <div class="lang" data-lang="es">ES</div>
      <div class="lang" data-lang="it">IT</div>
    </div>
    <button class="mainbtn" id="startBtn">BOOT</button>
  </div>
</div>

<div class="modal hidden" id="end">
  <div class="card">
    <h2 style="color:var(--pink)">SYSTEM CRASH</h2>
    <p>FINAL SCORE: <b id="final"></b></p>
    <button class="mainbtn" onclick="restart()">REBOOT</button>
  </div>
</div>

<script type="module">
import { loadLangPool, createUsedSet, pick } from "/js/langpool.js";

const $=id=>document.getElementById(id);

let lang="en", muted=false;
let score=0, lives=3;
let current=null, busy=false;

const LANGMAP={en:"en-US",de:"de-DE",fr:"fr-FR",es:"es-ES",it:"it-IT"};

document.querySelectorAll(".lang").forEach(b=>{
  b.onclick=()=>{
    document.querySelectorAll(".lang").forEach(x=>x.classList.remove("active"));
    b.classList.add("active");
    lang=b.dataset.lang;
    $("langBadge").textContent=lang.toUpperCase();
  };
});

$("soundBtn").onclick=()=>{muted=!muted;$("soundBtn").textContent=muted?"üîá":"üîä";};

$("startBtn").onclick=async()=>{
  $("start").classList.add("hidden");
  $("game").style.display="flex";
  score=0;lives=3;
  updateUI();
  await next();
};

async function next(){
  if(lives<=0){finish();return;}
  const pool=await loadLangPool(lang);
  const {used,save}=createUsedSet("glitch_hunter_"+lang);
  const picked=pick(pool,1,used,save);
  const w=picked[0];
  current={
    text: w.sentence || `I like ${w.w}.`,
    ok: Math.random()>0.5,
    fix: `I like ${w.w}.`
  };
  if(!current.ok){
    current.text = current.text.replace(" like "," likes ");
  }
  $("sentence").textContent=current.text;
  busy=false;
}

function answer(stable){
  if(busy) return;
  busy=true;
  const right = (stable===current.ok);
  if(right){
    score+=100;
    showToast("‚úî SYSTEM OK");
    speak(current.fix);
    setTimeout(()=>{updateUI();next();},1200);
  }else{
    lives--;
    glitch();
    showToast("‚úñ ERROR");
    if(lives<=0) setTimeout(finish,1000);
    else setTimeout(next,1000);
    updateUI();
  }
}

function updateUI(){
  $("score").textContent=score;
  $("life").textContent=Math.round(lives/3*100)+"%";
}

function showToast(t){
  const box=$("toast");
  $("toastText").textContent=t;
  box.className="toast show";
  setTimeout(()=>box.classList.remove("show"),700);
}

function glitch(){
  $("frame").classList.add("glitch");
  setTimeout(()=>$("frame").classList.remove("glitch"),300);
}

function finish(){
  $("end").classList.remove("hidden");
  $("final").textContent=score;
  speak(current?.fix||"");
}

function restart(){
  $("end").classList.add("hidden");
  $("game").style.display="flex";
  score=0;lives=3;
  updateUI();
  next();
}

function speak(t){
  if(muted||!t) return;
  const u=new SpeechSynthesisUtterance(t);
  u.lang=LANGMAP[lang]||"en-US";
  speechSynthesis.cancel();
  speechSynthesis.speak(u);
}
</script>
</body>
</html>
