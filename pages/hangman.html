<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"/>
  <title>italkyAI ‚Ä¢ Neon Hangman Premium</title>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;700;800&family=Space+Grotesk:wght@700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg-deep:#020205; --text-white:#ffffff;
      --c-neon-pink:#ff00ff; --c-neon-blue:#00f3ff;
      --c-neon-green:#00e676; --c-error:#ff1744;
      --ai-gradient: linear-gradient(135deg,#a5b4fc 0%,#6366f1 100%);
      --border: rgba(255,255,255,.12);
      --radius-xl: 28px;
    }

    *{ box-sizing:border-box; outline:none; user-select:none; -webkit-tap-highlight-color:transparent; }
    html,body{ margin:0; width:100%; height:100%; overflow:hidden; font-family:'Outfit', sans-serif; background:var(--bg-deep); color:#fff; position:fixed; }

    .cosmos-bg{ position:absolute; inset:0; z-index:0; background: radial-gradient(circle at 50% 35%, #0b0b2a 0%, #020205 60%, #010104 100%); }
    .stars{ position:absolute; inset:0; background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.15'/%3E%3C/svg%3E"); opacity:.5; }

    @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-3px); } 50% { transform: translateX(3px); } 75% { transform: translateX(-2px); } }
    .gallows-box.shake { animation: shake .25s linear 2; }

    .wrap{ width:100%; max-width:480px; height:100%; margin:0 auto; position:relative; z-index:10; display:flex; flex-direction:column; padding: calc(10px + env(safe-area-inset-top)) 0 calc(10px + env(safe-area-inset-bottom)); }
    .nav-top{ display:flex; align-items:center; justify-content:space-between; padding: 10px 18px; }
    .mini-badge{ display:flex; align-items:center; height: 38px; padding: 0 12px; border-radius: 16px; background: rgba(255,255,255,.05); border: 1px solid rgba(255,255,255,.10); font-weight: 800; font-size: 11px; box-shadow: 0 8px 20px rgba(0,0,0,0.3); }

    .game-card{ background: rgba(255,255,255,.05); border: 1px solid var(--border); border-radius: var(--radius-xl); backdrop-filter: blur(14px); padding: 20px; margin: 0 14px; position:relative; box-shadow: 0 30px 90px rgba(0,0,0,.65); }

    /* GALLOWS */
    .gallows-box{ position:relative; width:120px; height:140px; margin: 0 auto 15px; }
    .g-stand{ position:absolute; bottom:0; left:20px; width:80px; height:2px; background: #fff; }
    .g-post{ position:absolute; bottom:0; left:30px; width:2px; height:130px; background: #fff; }
    .g-top{ position:absolute; top:10px; left:30px; width:60px; height:2px; background: #fff; }
    .g-rope{ position:absolute; top:10px; right:30px; width:1px; height:20px; background: var(--c-neon-pink); box-shadow: 0 0 10px var(--c-neon-pink); }
    .g-rope.danger { background: var(--c-error) !important; width: 2px; box-shadow: 0 0 15px var(--c-error); }

    /* MAN PARTS */
    .man-part{ position:absolute; background: var(--c-neon-pink); box-shadow: 0 0 12px var(--c-neon-pink); opacity:0; transition: opacity .3s; }
    .p1{ top:28px; right:17px; width:26px; height:26px; border: 3px solid var(--c-neon-pink); border-radius:50%; background:transparent; }
    .p2{ top:56px; right:30px; width:2px; height:32px; }
    .p3{ top:60px; right:32px; width:18px; height:2px; transform: rotate(-25deg); transform-origin:left; }
    .p4{ top:60px; right:12px; width:18px; height:2px; transform: rotate(25deg); transform-origin:right; }
    /* ‚úÖ BACAKLAR - SABƒ∞T Pƒ∞VOT */
    .p5{ top: 92px; right: 30px; width: 18px; height: 2px; transform: rotate(35deg); transform-origin: 0% 50%; }
    .p6{ top: 92px; right: 30px; width: 18px; height: 2px; transform: rotate(-35deg); transform-origin: 0% 50%; }

    /* UI & KEYBOARD */
    .keyboard{ display:grid; grid-template-columns: repeat(7, 1fr); gap: 6px; margin-top: 15px; }
    .key-btn{ 
      aspect-ratio:1; display:flex; align-items:center; justify-content:center;
      color: #fff; background: linear-gradient(180deg, rgba(255,255,255,0.15), rgba(255,255,255,0.05));
      border: 1px solid rgba(255,255,255,0.2); border-radius: 12px; font-weight: 800; cursor:pointer;
      box-shadow: 0 5px 10px rgba(0,0,0,0.4); text-shadow: 0 0 5px rgba(255,255,255,0.2);
    }
    .key-btn.correct{ background: var(--c-neon-green) !important; color:#000; border-color: var(--c-neon-green); }
    .key-btn.wrong{ opacity: 0.3; filter: grayscale(1); }

    .word-box{ display:flex; flex-wrap:wrap; justify-content:center; gap: 8px; margin: 20px 0; }
    .letter-slot{ width: 30px; height: 40px; border-bottom: 2px solid var(--c-neon-blue); display:flex; align-items:center; justify-content:center; font-size: 22px; font-weight: 900; }
    .btn-primary{ width:100%; padding: 16px; background: var(--c-neon-green); color:#000; border:none; border-radius: 18px; font-weight: 900; cursor:pointer; margin-top: 10px; }
    
    .modal-wrap{ position:absolute; inset:0; background: rgba(0,0,0,.95); z-index:999; display:flex; align-items:center; justify-content:center; padding: 20px; }
    .modal-card{ width:100%; max-width:340px; background: #0a0a0f; border: 1px solid var(--border); border-radius: 30px; padding: 30px; text-align:center; }
  </style>
</head>

<body>
  <div class="cosmos-bg"><div class="stars"></div></div>

  <div class="wrap">
    <div class="nav-top">
      <div style="font-size:24px; font-weight:900;">italky<span style="color:var(--c-neon-blue)">AI</span></div>
      <div style="display:flex; gap:8px;">
        <div class="mini-badge">CAN <span id="lifeDisplay" style="color:var(--c-neon-pink); margin-left:5px;">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span></div>
        <div class="mini-badge">HATA <span id="mistakeDisplay" style="color:var(--c-neon-blue); margin-left:5px;">0/0</span></div>
      </div>
    </div>

    <div class="game-card">
      <div class="gallows-box" id="gallowsBox">
        <div class="g-stand"></div><div class="g-post"></div><div class="g-top"></div><div class="g-rope" id="mainRope"></div>
        <div class="man-part p1"></div><div class="man-part p2"></div><div class="man-part p3"></div>
        <div class="man-part p4"></div><div class="man-part p5"></div><div class="man-part p6"></div>
      </div>
      <div id="hintMain" style="text-align:center; color:var(--c-neon-green); font-weight:800; font-size:18px;"></div>
      <div id="wordBox" class="word-box"></div>
      <div class="keyboard" id="keyboard"></div>
      <button class="btn-primary" style="background:var(--ai-gradient); color:#fff" onclick="useJoker()">‚ö° ƒ∞PUCU (<span id="jokerCount">1</span>)</button>
    </div>
  </div>

  <div class="modal-wrap" id="startModal">
    <div class="modal-card">
      <h2 style="margin-bottom:10px">HO≈û GELDƒ∞N BA≈ûKANIM</h2>
      <p style="opacity:0.6; font-size:13px; margin-bottom:20px;">3 adamƒ±n asƒ±lmasƒ±na izin verirseniz oyun biter!</p>
      <button class="btn-primary" onclick="selectLevel('A2')">KOLAY (A1/A2)</button>
      <button class="btn-primary" onclick="selectLevel('B1')">ORTA (B1)</button>
      <button class="btn-primary" onclick="selectLevel('B2')">ZOR (B2)</button>
    </div>
  </div>

  <div class="modal-wrap" id="endModal" style="display:none">
    <div class="modal-card">
      <h1 id="endTitle">ELENDƒ∞Nƒ∞Z</h1>
      <p id="endMsg" style="margin:20px 0; opacity:0.7;"></p>
      <button class="btn-primary" onclick="location.reload()">BA≈ûTAN BA≈ûLA</button>
    </div>
  </div>

<script type="module">
import { loadLangPool, createUsedSet, pick } from "/js/langpool.js";

const $ = (id) => document.getElementById(id);
let currentDiff = "A2", wordList = [], currentIndex = 0;
let mistakes = 0, lives = 3, currentWord = "", currentRaw = "", discovered = [], jokers = 1, score = 0;

// SES EFEKTLERƒ∞ (Audio Context ile) ‚úÖ
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playSound(type) {
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc.connect(gain); gain.connect(audioCtx.destination);
  
  if(type === 'click') { 
    osc.type = 'sine'; osc.frequency.setValueAtTime(400, audioCtx.currentTime); 
    gain.gain.setValueAtTime(0.1, audioCtx.currentTime); gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
    osc.start(); osc.stop(audioCtx.currentTime + 0.1);
  } else if(type === 'success') {
    osc.frequency.setValueAtTime(600, audioCtx.currentTime); osc.frequency.exponentialRampToValueAtTime(800, audioCtx.currentTime + 0.2);
    gain.gain.setValueAtTime(0.1, audioCtx.currentTime); osc.start(); osc.stop(audioCtx.currentTime + 0.2);
  } else if(type === 'fail') {
    osc.frequency.setValueAtTime(200, audioCtx.currentTime); osc.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.3);
    gain.gain.setValueAtTime(0.2, audioCtx.currentTime); osc.start(); osc.stop(audioCtx.currentTime + 0.3);
  }
}

function buzz() { if(navigator.vibrate) navigator.vibrate(15); }

window.selectLevel = (diff) => { currentDiff = diff; initGame(); };

async function initGame() {
  try {
    const rawPool = await loadLangPool("en");
    const { used, save } = createUsedSet(`used_hangman_${currentDiff}`);
    const cfg = { A2: { min:3, max:6 }, B1: { min:6, max:9 }, B2: { min:9, max:15 } }[currentDiff];

    wordList = pick(rawPool, 15, used, save, (it) => {
      const match = (currentDiff === "A2") ? ["A1","A2"].includes(it.lvl) : it.lvl === currentDiff;
      return match && it.w.length >= cfg.min && it.w.length <= cfg.max;
    });

    $("startModal").style.display = "none";
    startRound();
  } catch (e) { alert("Hata!"); }
}

function startRound() {
  if(currentIndex >= wordList.length) { gameOver(true); return; }
  const data = wordList[currentIndex];
  currentRaw = data.w;
  currentWord = data.w.trim().toUpperCase().replace(/[^A-Z]/g, "");
  mistakes = 0;
  discovered = new Array(currentWord.length).fill(false);
  
  $("mainRope").classList.remove("danger");
  $("gallowsBox").classList.remove("shake");
  $("hintMain").textContent = data.tr;
  renderWord(); renderKeyboard(); renderHangman(); updateUI();
}

function maxMistakes() { return currentDiff === "A2" ? 8 : (currentDiff === "B1" ? 7 : 6); }

function renderHangman() {
  const MAX = maxMistakes();
  const visible = Math.min(mistakes, 6);
  $("mainRope").classList.toggle("danger", mistakes >= 6);
  
  if(mistakes === MAX - 1) { $("gallowsBox").classList.add("shake"); } 
  else { $("gallowsBox").classList.remove("shake"); }

  for (let i = 1; i <= 6; i++) {
    document.querySelector(`.p${i}`).style.opacity = (i <= visible) ? "1" : "0";
  }
}

function handleGuess(char, btn) {
  const MAX = maxMistakes();
  if(!btn || btn.disabled) return;
  btn.disabled = true;
  playSound('click'); buzz();

  if(currentWord.includes(char)) {
    btn.classList.add("correct");
    currentWord.split("").forEach((c, i) => { if(c === char) discovered[i] = true; });
    renderWord();
    if(discovered.every(v => v)) {
      playSound('success'); score += 10;
      setTimeout(() => { currentIndex++; startRound(); }, 1000);
    }
  } else {
    btn.classList.add("wrong");
    mistakes++;
    renderHangman(); updateUI();
    if(mistakes >= MAX) {
      lives--; playSound('fail');
      if(lives <= 0) { gameOver(false); }
      else { setTimeout(() => startRound(), 1000); }
    }
  }
}

function renderWord() {
  const box = $("wordBox"); box.innerHTML = "";
  currentWord.split("").forEach((ch, i) => {
    const d = document.createElement("div");
    d.className = "letter-slot";
    d.textContent = discovered[i] ? ch : "";
    box.appendChild(d);
  });
}

function renderKeyboard() {
  const kb = $("keyboard"); kb.innerHTML = "";
  "ABC√áDEFGƒûHIƒ∞JKLMNO√ñPRS≈ûTU√úVYZ".split("").forEach(char => {
    const b = document.createElement("button");
    b.className = "key-btn"; b.textContent = char;
    b.onclick = () => handleGuess(char, b);
    kb.appendChild(b);
  });
}

function updateUI() {
  $("mistakeDisplay").textContent = `${mistakes}/${maxMistakes()}`;
  $("lifeDisplay").textContent = "‚ù§Ô∏è".repeat(lives);
  $("jokerCount").textContent = jokers;
}

function gameOver(win) {
  $("endModal").style.display = "flex";
  $("endTitle").textContent = win ? "ZAFER! üèÜ" : "ELENDƒ∞Nƒ∞Z";
  $("endMsg").textContent = `Toplam Skorunuz: ${score}`;
}

window.useJoker = () => {
  if(jokers <= 0) return;
  const h = discovered.map((v, i) => v ? -1 : i).filter(i => i !== -1);
  if(h.length > 0) {
    const char = currentWord[h[Math.floor(Math.random() * h.length)]];
    jokers--; updateUI();
    const btns = document.querySelectorAll(".key-btn");
    btns.forEach(b => { if(b.textContent === char) handleGuess(char, b); });
  }
};
</script>
</body>
</html>
