<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>ITALKY â€¢ Neural Match</title>
  <link rel="icon" href="data:," />
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;700;900&family=Space+Grotesk:wght@700&display=swap" rel="stylesheet">
  <style>
    /* --- TEMA: NEURAL CYBERPUNK --- */
    :root {
      --bg-deep: #05000a;
      --panel-bg: rgba(20, 0, 30, 0.9);
      --neon-pink: #ff00ff;
      --neon-cyan: #00f3ff;
      --neon-purple: #bd00ff;
      --text: #ffffff;
      --border: rgba(189, 0, 255, 0.3);
    }

    * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; outline: none; }
    html, body { margin: 0; width: 100%; height: 100%; overflow: hidden; position: fixed; font-family: 'Outfit', sans-serif; background: var(--bg-deep); color: var(--text); display: flex; align-items: center; justify-content: center; }

    /* ARKA PLAN */
    .cosmos-bg { position: absolute; inset: 0; background: radial-gradient(circle at center, #1a002b 0%, #000 100%); z-index: 0; }
    .grid-lines { 
      position: absolute; inset: 0; 
      background-image: linear-gradient(rgba(189,0,255,0.1) 1px, transparent 1px), linear-gradient(90deg, rgba(189,0,255,0.1) 1px, transparent 1px);
      background-size: 40px 40px; opacity: 0.4;
    }

    /* Ã‡ERÃ‡EVE */
    .mobile-frame {
      width: 100%; max-width: 480px; height: 100%; position: relative; z-index: 10;
      display: flex; flex-direction: column; background: var(--panel-bg);
      backdrop-filter: blur(20px); border: 1px solid var(--border); overflow: hidden;
      box-shadow: 0 0 40px rgba(189,0,255,0.2);
    }
    @media(min-width: 520px) { .mobile-frame { height: 92vh; border-radius: 32px; } }

    /* HEADER */
    .header { flex: 0 0 70px; padding: 0 20px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid var(--border); background: linear-gradient(180deg, rgba(0,0,0,0.5), transparent); }
    .nav-btn { width: 40px; height: 40px; border-radius: 12px; background: rgba(255,255,255,0.05); border: 1px solid var(--border); color: #fff; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.2s; }
    .nav-btn:active { transform: scale(0.95); background: var(--neon-purple); }
    
    .page-title { font-family: 'Space Grotesk', sans-serif; font-size: 20px; font-weight: 700; letter-spacing: 1px; color: var(--neon-pink); text-shadow: 0 0 10px var(--neon-pink); text-transform: uppercase; }
    .lang-badge { font-size: 10px; padding: 4px 8px; background: var(--neon-purple); border-radius: 6px; color: #fff; margin-left: 8px; vertical-align: middle; }

    /* OYUN ALANI */
    .game-area { flex: 1; padding: 15px; display: flex; flex-direction: column; }

    /* STATS */
    .stats-row { display: flex; justify-content: space-between; padding: 10px 5px; margin-bottom: 10px; font-family: 'Space Grotesk', sans-serif; font-size: 14px; color: var(--neon-cyan); text-transform: uppercase; letter-spacing: 1px; border-bottom: 1px dashed var(--border); }
    
    /* GRID (KARTLAR) */
    .card-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      grid-template-rows: repeat(4, 1fr);
      gap: 10px;
      width: 100%;
      height: 100%; /* Kare olmasÄ± iÃ§in JS ile ayarlanabilir veya aspect-ratio */
      max-height: 450px; /* Mobilde taÅŸmasÄ±n */
      margin: auto 0;
    }

    /* KART YAPISI (3D FLIP) */
    .card {
      background: transparent;
      perspective: 1000px;
      cursor: pointer;
      position: relative;
    }
    .card-inner {
      position: relative;
      width: 100%;
      height: 100%;
      text-align: center;
      transition: transform 0.4s;
      transform-style: preserve-3d;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.5);
    }
    .card.flipped .card-inner {
      transform: rotateY(180deg);
    }
    .card.matched .card-inner {
      transform: rotateY(180deg);
      box-shadow: 0 0 15px var(--neon-green, #00e676);
    }
    .card.matched .card-back {
      border-color: #00e676;
      background: rgba(0, 230, 118, 0.15);
    }

    /* Ã–N VE ARKA YÃœZ */
    .card-front, .card-back {
      position: absolute;
      width: 100%;
      height: 100%;
      -webkit-backface-visibility: hidden; /* Safari */
      backface-visibility: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 12px;
      border: 1px solid var(--border);
    }

    /* Ã–N YÃœZ (KAPALI) */
    .card-front {
      background: linear-gradient(135deg, rgba(255,255,255,0.05), rgba(255,255,255,0.01));
      color: var(--neon-purple);
      font-size: 24px;
    }
    .card-front::after { content: 'ğŸ§ '; opacity: 0.5; font-size: 20px; filter: grayscale(100%); }

    /* ARKA YÃœZ (AÃ‡IK) */
    .card-back {
      background: rgba(20, 0, 40, 0.9);
      color: #fff;
      transform: rotateY(180deg);
      padding: 5px;
      font-size: 13px; /* Uzun kelimeler sÄ±ÄŸsÄ±n */
      font-weight: 700;
      word-break: break-word;
      border: 1px solid var(--neon-cyan);
    }

    /* MODAL */
    .modal-wrap { position: absolute; inset: 0; background: rgba(0,0,0,0.95); z-index: 99; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(10px); }
    .modal-card { width: 85%; max-width: 320px; background: #10051a; border: 1px solid var(--neon-pink); padding: 25px; text-align: center; border-radius: 20px; box-shadow: 0 0 50px rgba(255,0,255,0.2); }
    
    .lang-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-top: 20px; }
    .lang-btn {
      background: rgba(255,255,255,0.05); border: 1px solid var(--border); color: #fff;
      padding: 10px; border-radius: 8px; font-weight: 600; cursor: pointer; transition: 0.2s;
    }
    .lang-btn:active { background: var(--neon-pink); color: #000; border-color: var(--neon-pink); }

    .btn-main {
      width: 100%; padding: 15px; margin-top: 20px;
      background: var(--neon-pink); color: #fff; font-weight: 800; font-size: 16px;
      border: none; border-radius: 12px; cursor: pointer; text-transform: uppercase;
      box-shadow: 0 5px 20px rgba(255,0,255,0.3);
    }
    .btn-sec { background: transparent; border: 1px solid #fff; margin-top: 10px; box-shadow: none; }

    /* EFEKTLER */
    @keyframes shake { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-5px)} 75%{transform:translateX(5px)} }
    .shake { animation: shake 0.4s; border-color: var(--error, #ff1744) !important; }

    .hidden { display: none !important; }
  </style>
</head>
<body>

  <div class="cosmos-bg"><div class="grid-lines"></div></div>

  <div class="mobile-frame">
    <div class="header">
      <div class="nav-btn" onclick="location.href='/pages/game.html'">â†</div>
      <div class="page-title">NEURAL MATCH <span id="langBadge" class="lang-badge">EN</span></div>
      <div class="nav-btn" onclick="toggleSound()" id="soundIcon">ğŸ”Š</div>
    </div>

    <div class="game-area" id="gameScreen" style="display:none">
      <div class="stats-row">
        <span>HAMLE: <span id="moveVal" style="color:#fff">0</span></span>
        <span>EÅLEÅME: <span id="matchVal" style="color:#fff">0</span> / 8</span>
      </div>

      <div class="card-grid" id="gridArea">
        </div>
    </div>
  </div>

  <div class="modal-wrap" id="startModal">
    <div class="modal-card">
      <h2 style="color:var(--neon-cyan); margin:0; font-family:'Space Grotesk'">NEURAL LINK</h2>
      <p style="color:#fff; opacity:0.7; font-size:13px; margin-top:10px">Beyin nÃ¶ronlarÄ±nÄ± eÅŸleÅŸtir.<br>HafÄ±zanÄ± test et.</p>
      
      <div class="lang-grid">
        <div class="lang-btn" onclick="selectLang('en')">ğŸ‡¬ğŸ‡§ EN</div>
        <div class="lang-btn" onclick="selectLang('de')">ğŸ‡©ğŸ‡ª DE</div>
        <div class="lang-btn" onclick="selectLang('fr')">ğŸ‡«ğŸ‡· FR</div>
        <div class="lang-btn" onclick="selectLang('es')">ğŸ‡ªğŸ‡¸ ES</div>
        <div class="lang-btn" onclick="selectLang('it')">ğŸ‡®ğŸ‡¹ IT</div>
      </div>
    </div>
  </div>

  <div class="modal-wrap hidden" id="endModal">
    <div class="modal-card">
      <h2 style="color:var(--neon-green, #00e676); margin:0;">BAÄLANTI KURULDU</h2>
      <div style="font-size:14px; opacity:0.8; margin:15px 0;">
        Toplam Hamle: <strong id="finalMoves" style="color:#fff">0</strong><br>
        HafÄ±za Skorun: <strong id="finalScore" style="color:var(--neon-pink)">%100</strong>
      </div>
      <button class="btn-main" onclick="restartGame()">YENÄ°DEN BAÅLA</button>
      <button class="btn-main btn-sec" onclick="location.href='/pages/game.html'">Ã‡IKIÅ</button>
    </div>
  </div>

<script>
// --- OFFLINE DATABASE (Her dil iÃ§in 80+ Kelime) ---
// Not: Her oyun iÃ§in rastgele 8 Ã§ift (16 kart) seÃ§ilir.
const MEMORY_DB = {
  en: [
    ["Apple","Elma"],["Sun","GÃ¼neÅŸ"],["Moon","Ay"],["Star","YÄ±ldÄ±z"],["Water","Su"],["Fire","AteÅŸ"],
    ["Book","Kitap"],["Love","AÅŸk"],["Time","Zaman"],["Money","Para"],["Car","Araba"],["Door","KapÄ±"],
    ["Cat","Kedi"],["Dog","KÃ¶pek"],["Bird","KuÅŸ"],["Tree","AÄŸaÃ§"],["Red","KÄ±rmÄ±zÄ±"],["Blue","Mavi"],
    ["Fish","BalÄ±k"],["Milk","SÃ¼t"],["Rain","YaÄŸmur"],["Snow","Kar"],["Wind","RÃ¼zgar"],["Road","Yol"]
  ],
  de: [
    ["Apfel","Elma"],["Sonne","GÃ¼neÅŸ"],["Mond","Ay"],["Stern","YÄ±ldÄ±z"],["Wasser","Su"],["Feuer","AteÅŸ"],
    ["Buch","Kitap"],["Liebe","AÅŸk"],["Zeit","Zaman"],["Geld","Para"],["Auto","Araba"],["TÃ¼r","KapÄ±"],
    ["Katze","Kedi"],["Hund","KÃ¶pek"],["Vogel","KuÅŸ"],["Baum","AÄŸaÃ§"],["Rot","KÄ±rmÄ±zÄ±"],["Blau","Mavi"],
    ["Fisch","BalÄ±k"],["Milch","SÃ¼t"],["Regen","YaÄŸmur"],["Schnee","Kar"],["Wind","RÃ¼zgar"],["Weg","Yol"]
  ],
  fr: [
    ["Pomme","Elma"],["Soleil","GÃ¼neÅŸ"],["Lune","Ay"],["Ã‰toile","YÄ±ldÄ±z"],["Eau","Su"],["Feu","AteÅŸ"],
    ["Livre","Kitap"],["Amour","AÅŸk"],["Temps","Zaman"],["Argent","Para"],["Voiture","Araba"],["Porte","KapÄ±"],
    ["Chat","Kedi"],["Chien","KÃ¶pek"],["Oiseau","KuÅŸ"],["Arbre","AÄŸaÃ§"],["Rouge","KÄ±rmÄ±zÄ±"],["Bleu","Mavi"],
    ["Poisson","BalÄ±k"],["Lait","SÃ¼t"],["Pluie","YaÄŸmur"],["Neige","Kar"],["Vent","RÃ¼zgar"],["Route","Yol"]
  ],
  es: [
    ["Manzana","Elma"],["Sol","GÃ¼neÅŸ"],["Luna","Ay"],["Estrella","YÄ±ldÄ±z"],["Agua","Su"],["Fuego","AteÅŸ"],
    ["Libro","Kitap"],["Amor","AÅŸk"],["Tiempo","Zaman"],["Dinero","Para"],["Coche","Araba"],["Puerta","KapÄ±"],
    ["Gato","Kedi"],["Perro","KÃ¶pek"],["PÃ¡jaro","KuÅŸ"],["Ãrbol","AÄŸaÃ§"],["Rojo","KÄ±rmÄ±zÄ±"],["Azul","Mavi"],
    ["Pez","BalÄ±k"],["Leche","SÃ¼t"],["Lluvia","YaÄŸmur"],["Nieve","Kar"],["Viento","RÃ¼zgar"],["Camino","Yol"]
  ],
  it: [
    ["Mela","Elma"],["Sole","GÃ¼neÅŸ"],["Luna","Ay"],["Stella","YÄ±ldÄ±z"],["Acqua","Su"],["Fuoco","AteÅŸ"],
    ["Libro","Kitap"],["Amore","AÅŸk"],["Tempo","Zaman"],["Soldi","Para"],["Macchina","Araba"],["Porta","KapÄ±"],
    ["Gatto","Kedi"],["Cane","KÃ¶pek"],["Uccello","KuÅŸ"],["Albero","AÄŸaÃ§"],["Rosso","KÄ±rmÄ±zÄ±"],["Blu","Mavi"],
    ["Pesce","BalÄ±k"],["Latte","SÃ¼t"],["Pioggia","YaÄŸmur"],["Neve","Kar"],["Vento","RÃ¼zgar"],["Strada","Yol"]
  ]
};

// --- STATE ---
let currentLang = 'en';
let gameCards = []; // { id, text, type, pairId }
let flippedCards = [];
let matchedCount = 0;
let moves = 0;
let isLocked = false; // Animasyon sÄ±rasÄ±nda tÄ±klamayÄ± engelle
let isMuted = false;

// --- INIT ---
function selectLang(l) {
  currentLang = l;
  document.getElementById('langBadge').innerText = l.toUpperCase();
  document.getElementById('startModal').style.display = 'none';
  document.getElementById('gameScreen').style.display = 'flex';
  startGame();
}

function restartGame() {
  document.getElementById('endModal').classList.add('hidden');
  startGame();
}

function startGame() {
  moves = 0;
  matchedCount = 0;
  flippedCards = [];
  isLocked = false;
  updateStats();
  
  // 1. Havuzdan Rastgele 8 Ã‡ift SeÃ§
  const pool = MEMORY_DB[currentLang];
  // Havuzu karÄ±ÅŸtÄ±r
  const shuffledPool = [...pool].sort(() => Math.random() - 0.5);
  const selectedPairs = shuffledPool.slice(0, 8); // Ä°lk 8 Ã§ifti al

  // 2. KartlarÄ± OluÅŸtur (16 Kart: 8 YabancÄ±, 8 TÃ¼rkÃ§e)
  gameCards = [];
  selectedPairs.forEach((pair, index) => {
    // YabancÄ± Kelime KartÄ±
    gameCards.push({
      id: `card-${index}-A`,
      pairId: index,
      text: pair[0],
      langCode: currentLang, // Okunacak dil
      isForeign: true
    });
    // TÃ¼rkÃ§e Anlam KartÄ±
    gameCards.push({
      id: `card-${index}-B`,
      pairId: index,
      text: pair[1],
      langCode: 'tr-TR',
      isForeign: false
    });
  });

  // 3. KartlarÄ± KarÄ±ÅŸtÄ±r
  gameCards.sort(() => Math.random() - 0.5);

  renderGrid();
}

function renderGrid() {
  const grid = document.getElementById('gridArea');
  grid.innerHTML = '';

  gameCards.forEach((card, index) => {
    // Kart HTML YapÄ±sÄ±
    const el = document.createElement('div');
    el.className = 'card';
    el.dataset.index = index;
    el.onclick = () => handleCardClick(index);

    el.innerHTML = `
      <div class="card-inner">
        <div class="card-front"></div>
        <div class="card-back">${card.text}</div>
      </div>
    `;
    grid.appendChild(el);
  });
}

// --- OYUN MANTIÄI ---
function handleCardClick(index) {
  if (isLocked) return;
  
  const cardEl = document.querySelectorAll('.card')[index];
  
  // Zaten aÃ§Ä±k veya eÅŸleÅŸmiÅŸse iÅŸlem yapma
  if (cardEl.classList.contains('flipped') || cardEl.classList.contains('matched')) return;

  // KartÄ± AÃ§
  flipCard(cardEl);
  flippedCards.push({ index: index, data: gameCards[index], el: cardEl });

  // Ä°kinci kart aÃ§Ä±ldÄ±ysa kontrol et
  if (flippedCards.length === 2) {
    moves++;
    updateStats();
    checkForMatch();
  } else {
    // Ä°lk kart aÃ§Ä±ldÄ±ÄŸÄ±nda (Opsiyonel: Ses Ã§alabiliriz ama kafa karÄ±ÅŸtÄ±rÄ±r, sadece eÅŸleÅŸince Ã§alalÄ±m)
    playSFX('flip');
  }
}

function flipCard(el) {
  el.classList.add('flipped');
}

function unflipCard(el) {
  el.classList.remove('flipped');
}

function checkForMatch() {
  isLocked = true; // DiÄŸer tÄ±klamalarÄ± engelle

  const card1 = flippedCards[0];
  const card2 = flippedCards[1];

  if (card1.data.pairId === card2.data.pairId) {
    // --- EÅLEÅME OLDU ---
    playSFX('match');
    
    // YabancÄ± kelimeyi bul ve seslendir
    const foreignCard = card1.data.isForeign ? card1 : card2;
    speak(foreignCard.data.text);

    setTimeout(() => {
      card1.el.classList.add('matched');
      card2.el.classList.add('matched');
      flippedCards = [];
      matchedCount++;
      updateStats();
      isLocked = false;

      if (matchedCount === 8) {
        setTimeout(endGame, 500);
      }
    }, 600);

  } else {
    // --- EÅLEÅME OLMADI ---
    playSFX('error');
    
    setTimeout(() => {
      unflipCard(card1.el);
      unflipCard(card2.el);
      flippedCards = [];
      isLocked = false;
    }, 1000); // 1 saniye bekle kapat
  }
}

function updateStats() {
  document.getElementById('moveVal').innerText = moves;
  document.getElementById('matchVal').innerText = matchedCount;
}

function endGame() {
  playSFX('win');
  document.getElementById('endModal').classList.remove('hidden');
  document.getElementById('finalMoves').innerText = moves;
  
  // HafÄ±za Skoru HesabÄ±: En iyi (8 hamle) -> %100. Her hata puan dÃ¼ÅŸÃ¼rÃ¼r.
  // 8 Ã‡ift var. Minimum 8 hamle. 
  // Skor = Max(0, 100 - (moves - 8) * 5) gibi basit bir mantÄ±k
  let successRate = Math.max(0, 100 - (moves - 8) * 10);
  document.getElementById('finalScore').innerText = `%${successRate}`;
}

// --- SES SÄ°STEMÄ° ---
const synth = window.speechSynthesis;
let audioCtx = new (window.AudioContext || window.webkitAudioContext)();

function toggleSound() {
  isMuted = !isMuted;
  document.getElementById('soundIcon').innerText = isMuted ? "ğŸ”‡" : "ğŸ”Š";
}

function playSFX(type) {
  if (isMuted) return;
  if (audioCtx.state === 'suspended') audioCtx.resume();
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc.connect(gain);
  gain.connect(audioCtx.destination);
  
  const t = audioCtx.currentTime;

  if (type === 'flip') {
    osc.frequency.setValueAtTime(400, t);
    osc.frequency.exponentialRampToValueAtTime(100, t + 0.1);
    gain.gain.setValueAtTime(0.05, t);
    gain.gain.linearRampToValueAtTime(0, t + 0.1);
    osc.start(t); osc.stop(t + 0.1);
  } else if (type === 'match') {
    osc.type = 'triangle';
    osc.frequency.setValueAtTime(440, t); // A4
    osc.frequency.setValueAtTime(554, t + 0.1); // C#5
    osc.frequency.setValueAtTime(659, t + 0.2); // E5
    gain.gain.setValueAtTime(0.1, t);
    gain.gain.linearRampToValueAtTime(0, t + 0.4);
    osc.start(t); osc.stop(t + 0.4);
  } else if (type === 'error') {
    osc.type = 'sawtooth';
    osc.frequency.value = 150;
    gain.gain.value = 0.1;
    osc.start(t); osc.stop(t + 0.2);
  } else if (type === 'win') {
    // Victory sound
    osc.type = 'square';
    osc.frequency.setValueAtTime(523, t);
    osc.frequency.setValueAtTime(659, t + 0.2);
    osc.frequency.setValueAtTime(784, t + 0.4);
    osc.frequency.setValueAtTime(1046, t + 0.6);
    gain.gain.setValueAtTime(0.1, t);
    gain.gain.linearRampToValueAtTime(0, t + 1.0);
    osc.start(t); osc.stop(t + 1.0);
  }
}

function speak(text) {
  if (isMuted) return;
  const tm = setTimeout(() => {}, 2000);
  try {
    synth.cancel();
    const u = new SpeechSynthesisUtterance(text);
    const langMap = { 'en': 'en-US', 'de': 'de-DE', 'fr': 'fr-FR', 'es': 'es-ES', 'it': 'it-IT' };
    u.lang = langMap[currentLang] || 'en-US';
    u.rate = 0.9;
    u.onend = () => clearTimeout(tm);
    synth.speak(u);
  } catch(e) { clearTimeout(tm); }
}

</script>
</body>
</html>
