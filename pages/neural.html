<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ITALKY â€¢ Neural Match â€” Final</title>
<link rel="icon" href="data:,">
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;700;900&family=Space+Grotesk:wght@700&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#05000a;
  --panel:rgba(20,0,30,.92);
  --pink:#ff00ff;
  --cyan:#00f3ff;
  --purple:#bd00ff;
  --green:#00e676;
  --red:#ff1744;
  --border:rgba(189,0,255,.3);
  --text:#fff;
}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent;user-select:none}
html,body{margin:0;width:100%;height:100%;background:var(--bg);font-family:Outfit,sans-serif;overflow:hidden;color:var(--text)}

.bg{position:absolute;inset:0;background:radial-gradient(circle at center,#1a002b 0%,#000 100%)}
.grid{position:absolute;inset:0;background-image:linear-gradient(rgba(189,0,255,.1) 1px,transparent 1px),linear-gradient(90deg,rgba(189,0,255,.1) 1px,transparent 1px);background-size:40px 40px;opacity:.4}

.app{position:relative;max-width:480px;height:100%;margin:0 auto;border:1px solid var(--border);background:var(--panel);display:flex;flex-direction:column;z-index:5}
@media(min-width:520px){.app{height:92vh;border-radius:32px}}

.header{height:70px;display:flex;align-items:center;justify-content:space-between;padding:0 16px;border-bottom:1px solid var(--border)}
.title{font-family:Space Grotesk;font-weight:900;color:var(--pink);letter-spacing:1px;text-shadow:0 0 12px var(--pink)}
.badge{font-size:10px;padding:4px 8px;border-radius:6px;background:var(--purple);margin-left:8px}

.stats{display:flex;justify-content:space-between;padding:10px 16px;font-family:Space Grotesk;color:var(--cyan);border-bottom:1px dashed var(--border)}
.stats span b{color:#fff}

.game{flex:1;padding:12px;display:none;flex-direction:column}
.grid-cards{display:grid;grid-template-columns:repeat(4,1fr);grid-template-rows:repeat(4,1fr);gap:10px;flex:1;max-height:460px}

.card{perspective:1000px;cursor:pointer}
.inner{width:100%;height:100%;transition:transform .4s;transform-style:preserve-3d;border-radius:14px}
.card.flipped .inner{transform:rotateY(180deg)}
.card.matched .inner{transform:rotateY(180deg);box-shadow:0 0 18px var(--green)}

.face{position:absolute;inset:0;border-radius:14px;display:flex;align-items:center;justify-content:center;border:1px solid var(--border);backface-visibility:hidden}
.front{background:linear-gradient(135deg,rgba(255,255,255,.06),rgba(255,255,255,.01));color:var(--purple);font-size:22px}
.front::after{content:"ðŸ§ ";opacity:.5}
.back{background:rgba(30,0,50,.95);color:#fff;transform:rotateY(180deg);font-weight:800;font-size:14px;text-align:center;padding:6px}

.modal{position:absolute;inset:0;background:rgba(0,0,0,.95);display:flex;align-items:center;justify-content:center;z-index:20}
.card-modal{background:#10051a;border:1px solid var(--pink);border-radius:24px;padding:26px;text-align:center;width:85%;box-shadow:0 0 50px rgba(255,0,255,.25)}
.langs{display:grid;grid-template-columns:repeat(5,1fr);gap:8px;margin-top:16px}
.lang{padding:10px;border-radius:10px;border:1px solid var(--border);cursor:pointer;font-weight:900}
.lang.active{background:var(--pink);color:#000}

.btn{width:100%;padding:14px;border:none;border-radius:14px;font-weight:900;margin-top:16px;background:var(--pink);color:#000}
.btn.sec{background:transparent;border:1px solid #fff;color:#fff}

.hidden{display:none!important}
</style>
</head>

<body>
<div class="bg"></div>
<div class="grid"></div>

<div class="app">
  <div class="header">
    <div class="title">NEURAL MATCH <span id="langBadge" class="badge">EN</span></div>
    <div id="soundBtn" style="cursor:pointer">ðŸ”Š</div>
  </div>

  <div class="stats">
    <span>HAMLE: <b id="moveVal">0</b></span>
    <span>EÅžLEÅžME: <b id="matchVal">0</b> / 8</span>
  </div>

  <div class="game" id="game">
    <div class="grid-cards" id="grid"></div>
  </div>
</div>

<div class="modal" id="start">
  <div class="card-modal">
    <h2 style="color:var(--cyan);margin:0;font-family:Space Grotesk">NEURAL LINK</h2>
    <p style="opacity:.7;font-size:13px">Kelime ile anlamÄ± eÅŸleÅŸtir.</p>
    <div class="langs">
      <div class="lang active" data-lang="en">EN</div>
      <div class="lang" data-lang="de">DE</div>
      <div class="lang" data-lang="fr">FR</div>
      <div class="lang" data-lang="es">ES</div>
      <div class="lang" data-lang="it">IT</div>
    </div>
    <button class="btn" id="startBtn">BAÅžLA</button>
  </div>
</div>

<div class="modal hidden" id="end">
  <div class="card-modal">
    <h2 style="color:var(--green);margin:0">BAÄžLANTI KURULDU</h2>
    <p style="margin:12px 0">
      Hamle: <b id="finalMoves"></b><br>
      Skor: <b id="finalScore"></b>
    </p>
    <button class="btn" onclick="restart()">YENÄ°DEN</button>
    <button class="btn sec" onclick="location.href='/pages/game.html'">Ã‡IKIÅž</button>
  </div>
</div>

<script type="module">
import { loadLangPool, createUsedSet, pick } from "/js/langpool.js";

const $=id=>document.getElementById(id);

let lang="en";
let cards=[],flipped=[],matched=0,moves=0,locked=false;
let muted=false;

const LANGMAP={en:"en-US",de:"de-DE",fr:"fr-FR",es:"es-ES",it:"it-IT"};

document.querySelectorAll(".lang").forEach(b=>{
  b.onclick=()=>{
    document.querySelectorAll(".lang").forEach(x=>x.classList.remove("active"));
    b.classList.add("active");
    lang=b.dataset.lang;
    $("langBadge").textContent=lang.toUpperCase();
  };
});

$("soundBtn").onclick=()=>{
  muted=!muted;
  $("soundBtn").textContent=muted?"ðŸ”‡":"ðŸ”Š";
};

$("startBtn").onclick=async()=>{
  $("start").classList.add("hidden");
  $("game").style.display="flex";
  await initGame();
};

async function initGame(){
  moves=0;matched=0;flipped=[];locked=false;
  updateStats();

  const pool=await loadLangPool(lang);
  const {used,save}=createUsedSet("neural_match_"+lang);
  const picked=pick(pool,8,used,save);

  cards=[];
  picked.forEach((it,i)=>{
    cards.push({pair:i,text:it.w,lang:lang});
    cards.push({pair:i,text:it.tr,lang:"tr"});
  });
  cards.sort(()=>Math.random()-.5);
  render();
}

function render(){
  const g=$("grid"); g.innerHTML="";
  cards.forEach((c,i)=>{
    const el=document.createElement("div");
    el.className="card";
    el.dataset.i=i;
    el.innerHTML=`
      <div class="inner">
        <div class="face front"></div>
        <div class="face back">${c.text}</div>
      </div>`;
    el.onclick=()=>clickCard(i);
    g.appendChild(el);
  });
}

function clickCard(i){
  if(locked) return;
  const el=document.querySelectorAll(".card")[i];
  if(el.classList.contains("flipped")||el.classList.contains("matched")) return;

  el.classList.add("flipped");
  flipped.push({i,data:cards[i],el});

  if(flipped.length===2){
    moves++; updateStats();
    check();
  }
}

function check(){
  locked=true;
  const [a,b]=flipped;
  if(a.data.pair===b.data.pair){
    play("match");
    const speakCard=a.data.lang!=="tr"?a.data:b.data;
    speak(speakCard.text,speakCard.lang);
    setTimeout(()=>{
      a.el.classList.add("matched");
      b.el.classList.add("matched");
      matched++;
      flipped=[];
      locked=false;
      updateStats();
      if(matched===8) finish();
    },500);
  }else{
    play("error");
    setTimeout(()=>{
      a.el.classList.remove("flipped");
      b.el.classList.remove("flipped");
      flipped=[];
      locked=false;
    },900);
  }
}

function updateStats(){
  $("moveVal").textContent=moves;
  $("matchVal").textContent=matched;
}

function finish(){
  play("win");
  $("finalMoves").textContent=moves;
  const score=Math.max(0,100-(moves-8)*10);
  $("finalScore").textContent="%"+score;
  $("end").classList.remove("hidden");
}

function restart(){
  $("end").classList.add("hidden");
  initGame();
}

let audioCtx=new (window.AudioContext||window.webkitAudioContext)();
function play(t){
  if(muted) return;
  if(audioCtx.state==="suspended") audioCtx.resume();
  const o=audioCtx.createOscillator(),g=audioCtx.createGain();
  o.connect(g); g.connect(audioCtx.destination);
  const now=audioCtx.currentTime;
  if(t==="match"){o.frequency.value=600;g.gain.value=.08;o.start(now);o.stop(now+.25);}
  if(t==="error"){o.frequency.value=140;g.gain.value=.1;o.start(now);o.stop(now+.2);}
  if(t==="win"){o.frequency.value=800;g.gain.value=.1;o.start(now);o.stop(now+.6);}
}

function speak(txt,l){
  if(muted) return;
  const u=new SpeechSynthesisUtterance(txt);
  u.lang=l==="tr"?"tr-TR":LANGMAP[l]||"en-US";
  speechSynthesis.cancel();
  speechSynthesis.speak(u);
}
</script>
</body>
</html>
