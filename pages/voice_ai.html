<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>italkyAI • Voice Live</title>
  <link rel="icon" href="data:," />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;700;800&family=Space+Grotesk:wght@700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg-deep: #020205;
      --text-main: #fff;
      --indigo: #6366f1;
      --cyan: #06b6d4;
      --pink: #ec4899;
      --orange: #f97316;
      --card-bg: rgba(20, 20, 25, 0.95);
      --glass-border: rgba(255, 255, 255, 0.1);
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }

    html, body {
      margin: 0; padding: 0; width: 100%; height: 100%;
      overflow: hidden; background: var(--bg-deep);
      font-family: 'Outfit', sans-serif; color: var(--text-main);
      display: flex; align-items: center; justify-content: center;
    }

    /* --- BACKGROUND (Atmosphere) --- */
    .cosmos-bg { position: absolute; inset: -50%; width: 200%; height: 200%; background: #000; z-index: 0; }
    .glow-spot {
      position: absolute; border-radius: 50%; filter: blur(100px); opacity: 0.3;
      animation: floatSpot 20s infinite alternate ease-in-out;
    }
    .gs-1 { top: 20%; left: 20%; width: 60vw; height: 60vw; background: radial-gradient(circle, var(--indigo), transparent 70%); }
    .gs-2 { bottom: 20%; right: 20%; width: 50vw; height: 50vw; background: radial-gradient(circle, var(--cyan), transparent 70%); animation-delay: -5s; }
    @keyframes floatSpot { from { transform: translate(0,0); } to { transform: translate(5%, 5%); } }

    .mobile-frame {
      width: 100%; max-width: 480px; height: 100%;
      position: relative; z-index: 10;
      display: flex; flex-direction: column;
      /* Cam efekti kaldırdım, daha derin siyah olsun */
      background: rgba(0,0,0,0.2); 
    }

    /* --- NAV (Back Only) --- */
    .nav-bar {
      height: 80px; padding: 0 20px; display: flex; align-items: center;
      position: absolute; top: 0; left: 0; width: 100%; z-index: 50;
    }
    .back-btn {
      width: 48px; height: 48px; border-radius: 50%;
      background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.1);
      display: flex; align-items: center; justify-content: center;
      color: #fff; cursor: pointer; transition: 0.2s;
    }
    .back-btn:active { background: rgba(255,255,255,0.2); transform: scale(0.95); }
    .back-btn svg { width: 24px; height: 24px; stroke-width: 2.5; }

    /* --- THE CORE (Liquid AI Animation) --- */
    .stage {
      flex: 1; display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      position: relative;
    }

    .ai-container {
      position: relative;
      width: 300px; height: 300px;
      display: flex; align-items: center; justify-content: center;
    }

    /* Organik Şekil (Blob) */
    .ai-core {
      position: absolute;
      width: 180px; height: 180px;
      background: #fff;
      border-radius: 50%;
      filter: blur(40px); /* Işık hüzmesi efekti */
      opacity: 0.8;
      transition: all 0.5s ease;
      /* Default: Idle (Bekliyor) */
      background: conic-gradient(from 0deg, var(--indigo), var(--cyan), var(--indigo));
      animation: spinColor 10s linear infinite, blobBreath 6s ease-in-out infinite;
    }

    /* --- STATE: LISTENING (Kullanıcı Konuşuyor) --- */
    /* İçine çekilme, odaklanma, renkler soğuk */
    .stage.listening .ai-core {
      width: 140px; height: 140px; /* Küçülür */
      filter: blur(25px); /* Netleşir */
      background: radial-gradient(circle, #fff, var(--cyan));
      animation: pulseIn 1s infinite alternate;
      border-radius: 50%; /* Tam yuvarlak */
    }

    /* --- STATE: SPEAKING (AI Konuşuyor) --- */
    /* Dışa vurum, renkler sıcak ve karmaşık, şekil sıvılaşıyor */
    .stage.speaking .ai-core {
      width: 220px; height: 220px; /* Büyür */
      filter: blur(50px); /* Dağılır */
      background: conic-gradient(from 0deg, var(--pink), var(--orange), var(--indigo), var(--pink));
      /* Sıvılaşma Animasyonu */
      border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%;
      animation: spinColor 3s linear infinite, blobMorph 4s ease-in-out infinite;
    }

    /* --- DURUM METNİ --- */
    .status-text {
      margin-top: 40px;
      font-family: 'Space Grotesk', sans-serif;
      font-size: 18px; font-weight: 700;
      color: rgba(255,255,255,0.7);
      letter-spacing: 1px;
      text-transform: uppercase;
      opacity: 0;
      transform: translateY(10px);
      transition: 0.5s;
    }
    .status-text.show { opacity: 1; transform: translateY(0); }

    /* Animasyonlar */
    @keyframes spinColor { 100% { transform: rotate(360deg); } }
    
    @keyframes blobBreath {
      0%, 100% { transform: scale(1); border-radius: 50%; }
      50% { transform: scale(1.1); border-radius: 45% 55% 50% 50%; }
    }

    @keyframes pulseIn {
      0% { transform: scale(1); box-shadow: inset 0 0 20px #fff; }
      100% { transform: scale(0.9); box-shadow: inset 0 0 50px #000; }
    }

    @keyframes blobMorph {
      0% { border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%; }
      50% { border-radius: 30% 60% 70% 40% / 50% 60% 30% 60%; }
      100% { border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%; }
    }

    /* --- MİKROFON BUTONU (Sabit) --- */
    .controls {
      padding: 30px; display: flex; justify-content: center;
      position: relative; z-index: 20;
    }
    .mic-btn {
      width: 80px; height: 80px; border-radius: 50%;
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.2);
      display: flex; align-items: center; justify-content: center;
      cursor: pointer; transition: 0.2s;
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    }
    .mic-btn:active { transform: scale(0.9); background: rgba(255,255,255,0.2); }
    .mic-btn svg { width: 32px; height: 32px; stroke: #fff; fill: none; stroke-width: 2; }
    
    /* Toggle Sınıfı (Aktifse kırmızı olsun - kapatmak için) */
    .mic-btn.active { background: rgba(239, 68, 68, 0.2); border-color: rgba(239, 68, 68, 0.5); }
    .mic-btn.active svg { stroke: #ef4444; }


    /* --- SES SEÇİM MODALI --- */
    .modal-overlay {
      position: fixed; inset: 0; z-index: 9999;
      background: rgba(0,0,0,0.8); backdrop-filter: blur(15px);
      display: none; align-items: flex-end; justify-content: center;
      padding: 16px; opacity: 0; transition: opacity 0.3s;
    }
    .modal-overlay.show { display: flex; opacity: 1; }

    .voice-card {
      width: 100%; max-width: 480px;
      background: var(--card-bg);
      border: 1px solid var(--glass-border);
      border-radius: 32px; padding: 24px;
      box-shadow: 0 -20px 50px rgba(0,0,0,0.8);
      transform: translateY(50px); transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
    }
    .modal-overlay.show .voice-card { transform: translateY(0); }

    .vc-title { font-size: 18px; font-weight: 700; color: #fff; margin-bottom: 20px; }
    
    .voice-list { display: flex; flex-direction: column; gap: 12px; max-height: 40vh; overflow-y: auto; }
    
    .voice-item {
      display: flex; align-items: center; justify-content: space-between;
      padding: 16px; border-radius: 18px;
      background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.05);
      cursor: pointer; transition: 0.2s;
    }
    .voice-item.selected { background: rgba(99, 102, 241, 0.2); border-color: var(--indigo); }
    
    .v-info { display: flex; flex-direction: column; }
    .v-name { font-weight: 700; font-size: 15px; color: #fff; }
    .v-lang { font-size: 12px; color: rgba(255,255,255,0.5); }

    .play-preview {
      width: 36px; height: 36px; border-radius: 50%;
      background: rgba(255,255,255,0.1); border: none;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer; color: #fff; margin-right: 10px;
    }
    .play-preview:hover { background: #fff; color: #000; }

    .save-btn {
      width: 100%; height: 56px; border-radius: 20px;
      background: linear-gradient(135deg, var(--indigo), var(--pink));
      border: none; color: #fff; font-weight: 700; font-size: 16px;
      margin-top: 20px; cursor: pointer;
    }
  </style>
</head>

<body>
  <div class="cosmos-bg">
    <div class="glow-spot gs-1"></div>
    <div class="glow-spot gs-2"></div>
  </div>

  <div class="mobile-frame">
    <div class="nav-bar">
      <div class="back-btn" onclick="window.location.href='/pages/home.html'">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
      </div>
    </div>

    <div class="stage" id="aiStage">
      <div class="ai-container">
        <div class="ai-core"></div>
      </div>
      
      <div class="status-text" id="statusText">italkyAI Dinliyor...</div>
    </div>

    <div class="controls">
      <button class="mic-btn" id="micToggle">
        <svg viewBox="0 0 24 24"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></svg>
      </button>
    </div>
  </div>

  <div class="modal-overlay" id="voiceModal">
    <div class="voice-card">
      <div class="vc-title">Asistanının Sesini Seç</div>
      <div class="voice-list" id="voiceListContainer">
        </div>
      <button class="save-btn" id="saveVoiceBtn">Seçimi Kaydet</button>
    </div>
  </div>

  <script type="module">
    // --- SES SEÇİMİ VE ANİMASYON MANTIĞI ---
    
    const stage = document.getElementById('aiStage');
    const statusText = document.getElementById('statusText');
    const micBtn = document.getElementById('micToggle');
    const voiceModal = document.getElementById('voiceModal');
    const voiceListEl = document.getElementById('voiceListContainer');
    
    let selectedVoiceIndex = -1;
    let voices = [];
    let isListening = false;

    // 1. Sesleri Yükle ve Modal Göster (Eğer seçilmediyse)
    function loadVoices() {
      voices = window.speechSynthesis.getVoices().filter(v => v.lang.startsWith('en') || v.lang.startsWith('tr')); // Sadece TR ve EN
      
      if (voices.length === 0) {
        setTimeout(loadVoices, 100); // Sesler geç yüklenirse tekrar dene
        return;
      }

      const savedVoice = localStorage.getItem('italky_voice_pref');
      if (!savedVoice) {
        openVoiceModal();
      }
    }

    function openVoiceModal() {
      voiceModal.classList.add('show');
      voiceListEl.innerHTML = '';

      voices.forEach((v, idx) => {
        const item = document.createElement('div');
        item.className = 'voice-item';
        item.innerHTML = `
          <div class="v-info">
            <div class="v-name">${v.name.slice(0, 20)}...</div>
            <div class="v-lang">${v.lang}</div>
          </div>
          <button class="play-preview" data-idx="${idx}">▶</button>
        `;
        
        // Satıra tıklayınca seç
        item.onclick = (e) => {
          if(e.target.classList.contains('play-preview')) return; // Play'e basınca seçme
          document.querySelectorAll('.voice-item').forEach(el => el.classList.remove('selected'));
          item.classList.add('selected');
          selectedVoiceIndex = idx;
        };

        // Play butonu (Demo)
        const playBtn = item.querySelector('.play-preview');
        playBtn.onclick = () => {
          const u = new SpeechSynthesisUtterance("Merhaba, ben italkyAI. Sesim nasıl?");
          u.voice = voices[idx];
          window.speechSynthesis.cancel();
          window.speechSynthesis.speak(u);
        };

        voiceListEl.appendChild(item);
      });
    }

    // 2. Kaydet Butonu
    document.getElementById('saveVoiceBtn').onclick = () => {
      if (selectedVoiceIndex > -1) {
        localStorage.setItem('italky_voice_pref', voices[selectedVoiceIndex].name);
        voiceModal.classList.remove('show');
        // İlk kayıttan sonra hoşgeldin desin
        setTimeout(() => simulateAI("Merhaba! Sesimi ayarladın. Senin için ne yapabilirim?"), 500);
      }
    };

    // 3. Simülasyon (Animasyon Testi İçin)
    // Gerçek entegrasyonda burayı API'ye bağlayacağız.
    // Şimdilik butona basınca "Dinliyor", bırakınca "Konuşuyor" moduna geçsin.

    micBtn.onclick = () => {
      isListening = !isListening;
      
      if (isListening) {
        // DİNLİYOR MODU (İçine Çekilme)
        micBtn.classList.add('active');
        stage.className = "stage listening";
        statusText.innerText = "Dinliyorum...";
        statusText.classList.add('show');
        window.speechSynthesis.cancel(); // AI susar
      } else {
        // DÜŞÜNME ve KONUŞMA MODU
        micBtn.classList.remove('active');
        stage.className = "stage"; // Önce normale dön
        statusText.innerText = "Düşünüyor...";
        
        // 1 saniye sonra konuşmaya başlasın (Simülasyon)
        setTimeout(() => {
          simulateAI("Şu an sesli arayüzü test ediyorsun. Bu animasyonlar konuşma durumuna göre değişiyor.");
        }, 1000);
      }
    };

    function simulateAI(text) {
      const u = new SpeechSynthesisUtterance(text);
      const prefName = localStorage.getItem('italky_voice_pref');
      const voice = voices.find(v => v.name === prefName) || voices[0];
      u.voice = voice;

      // Konuşma Başladı -> Patlama Efekti
      u.onstart = () => {
        stage.className = "stage speaking";
        statusText.innerText = "italkyAI Konuşuyor...";
      };

      // Konuşma Bitti -> Idle
      u.onend = () => {
        stage.className = "stage";
        statusText.classList.remove('show');
      };

      window.speechSynthesis.speak(u);
    }

    // Başlangıç
    window.speechSynthesis.onvoiceschanged = loadVoices;
    loadVoices();

  </script>
</body>
</html>
