<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<title>ITALKY ‚Ä¢ Word Cracker</title>
<link rel="icon" href="data:,">
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;700;800&family=Space+Grotesk:wght@700&family=Share+Tech+Mono&display=swap" rel="stylesheet">

<style>
:root{
--bg:#000500;--matrix:#00ff41;--dim:rgba(0,255,65,.15);
--err:#ff1744;--border:rgba(0,255,65,.4)
}
*{box-sizing:border-box;user-select:none;-webkit-tap-highlight-color:transparent}
html,body{margin:0;width:100%;height:100%;background:var(--bg);font-family:Outfit,sans-serif;overflow:hidden}
.cosmos{position:fixed;inset:0;background:radial-gradient(circle,#001a00 0%,#000 100%)}
.grid{position:absolute;inset:0;background-image:linear-gradient(var(--dim) 1px,transparent 1px),linear-gradient(90deg,var(--dim) 1px,transparent 1px);background-size:30px 30px;opacity:.3}

.frame{position:relative;z-index:5;width:100%;max-width:480px;height:100%;margin:auto;display:flex;flex-direction:column;background:rgba(0,10,0,.9);border:1px solid var(--border);box-shadow:0 0 30px var(--dim);transition:.2s}
@media(min-width:520px){.frame{height:92vh;border-radius:22px}}

.header{height:70px;display:flex;align-items:center;justify-content:space-between;padding:0 20px;border-bottom:1px solid var(--border)}
.btn{width:40px;height:40px;border:1px solid var(--border);background:rgba(0,255,65,.1);color:var(--matrix);border-radius:8px;display:flex;align-items:center;justify-content:center;font-weight:700;cursor:pointer}
.title{font-family:'Share Tech Mono';color:var(--matrix);letter-spacing:2px}
.badge{background:var(--matrix);color:#000;font-size:10px;padding:2px 6px;border-radius:4px;margin-left:6px}

.game{flex:1;padding:20px;display:none;flex-direction:column;gap:15px}
.stats{display:flex;justify-content:space-between;font-family:'Share Tech Mono';color:var(--matrix);border-bottom:1px dashed var(--border);padding-bottom:8px}

.hint{border:1px solid var(--matrix);padding:14px;border-radius:12px;text-align:center}
.hint-text{font-size:20px;font-weight:800;letter-spacing:1px}

.slots{display:flex;justify-content:center;flex-wrap:wrap;gap:6px;min-height:60px}
.slot{width:40px;height:50px;border:1px solid var(--matrix);border-radius:6px;display:flex;align-items:center;justify-content:center;font-family:'Share Tech Mono';font-size:28px;color:var(--matrix)}
.slot.empty{color:transparent;border-color:rgba(0,255,65,.2)}
.slot.wrong{border-color:var(--err);color:var(--err)}

.keys{flex:1;display:flex;flex-wrap:wrap;justify-content:center;gap:8px}
.key{width:48px;height:48px;border:1px solid var(--matrix);background:rgba(0,255,65,.15);border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:20px;font-weight:700;color:#fff;cursor:pointer}
.key.used{opacity:0;pointer-events:none}

.modal{position:fixed;inset:0;background:rgba(0,0,0,.95);display:flex;align-items:center;justify-content:center;z-index:99}
.card{background:#050505;border:1px solid var(--matrix);padding:24px;border-radius:16px;text-align:center;box-shadow:0 0 40px var(--dim)}
.langs{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:20px}
.lang{border:1px solid var(--matrix);padding:10px;border-radius:8px;color:#fff;cursor:pointer}
.lang:hover{background:var(--matrix);color:#000}

.flash{animation:flash .6s}
@keyframes flash{0%{box-shadow:0 0 0 rgba(0,255,65,0)}50%{box-shadow:0 0 80px rgba(0,255,65,.6)}100%{box-shadow:0 0 30px rgba(0,255,65,.15)}}
</style>
</head>

<body>
<div class="cosmos"><div class="grid"></div></div>

<div class="frame" id="frame">
  <div class="header">
    <div class="btn" onclick="location.href='/pages/game.html'">‚Üê</div>
    <div class="title">WORD_CRACKER <span id="langBadge" class="badge">EN</span></div>
    <div class="btn" onclick="toggleSound()" id="soundBtn">üîä</div>
  </div>

  <div class="game" id="game">
    <div class="stats">
      <span>SCORE: <span id="score">0</span></span>
      <span>LIVES: <span id="lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span></span>
    </div>
    <div class="hint"><div class="hint-text" id="hintText">...</div></div>
    <div class="slots" id="slots"></div>
    <div class="keys" id="keys"></div>
  </div>
</div>

<div class="modal" id="startModal">
  <div class="card">
    <h2 style="color:var(--matrix);font-family:'Share Tech Mono'">SYSTEM READY</h2>
    <div class="langs">
      <div class="lang" onclick="selectLang('en')">EN</div>
      <div class="lang" onclick="selectLang('de')">DE</div>
      <div class="lang" onclick="selectLang('fr')">FR</div>
      <div class="lang" onclick="selectLang('es')">ES</div>
      <div class="lang" onclick="selectLang('it')">IT</div>
    </div>
  </div>
</div>

<div class="modal" id="endModal" style="display:none">
  <div class="card">
    <h2 style="color:var(--matrix);font-family:'Share Tech Mono'">SYSTEM FAILURE</h2>
    <div id="endText" style="margin:15px 0"></div>
    <button class="lang" onclick="restart()">RETRY</button>
  </div>
</div>

<script type="module">
import { loadLangPool, createUsedSet, pick } from "/js/langpool.js";
const $=i=>document.getElementById(i);

let lang="en",pool=[],list=[],idx=0;
let word="",target=[],user=[],keys=[];
let score=0,lives=3,streak=0,boss=false,first=true;
let muted=false;

const bossEvery=5,baseDecoys=2,bossExtra=2;

function normalize(s){
 return String(s||"").replace(/√ü/g,"ss").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toUpperCase()
}

window.selectLang=async l=>{
 lang=l;$("langBadge").innerText=l.toUpperCase();
 $("startModal").style.display="none";
 $("game").style.display="flex";
 await prepare();
 restart();
}

async function prepare(){
 const data=await loadLangPool(lang);
 const {used,save}=createUsedSet("used_wordcracker_"+lang);
 pool=pick(data,30,used,save,it=>{
  const w=normalize(it.w).replace(/[^A-Z]/g,"");
  return w.length>=4&&w.length<=8;
 });
}

function restart(){
 score=0;lives=3;streak=0;idx=0;
 update();next();
}

function next(){
 boss=((idx+1)%bossEvery===0);first=true;
 const it=pool[idx%pool.length];
 word=normalize(it.w).replace(/[^A-Z]/g,"");
 target=word.split(""); user=new Array(target.length).fill(null);
 $("hintText").innerText=(boss?"‚ö†Ô∏è BOSS: ":"")+it.tr.toUpperCase();
 $("frame").style.boxShadow=boss?"0 0 55px rgba(0,255,65,.25)":"0 0 30px rgba(0,255,65,.15)";
 const base=target.map((c,i)=>({id:"t"+i,char:c}));
 keys=base.concat(decoys(target,boss?baseDecoys+bossExtra:baseDecoys)).sort(()=>Math.random()-.5);
 render();
}

function decoys(arr,n){
 const s=new Set(arr),a="ETAOINSHRDLUCMPFGYWBVKXJQZ",o=[];
 while(o.length<n){const c=a[Math.floor(Math.random()*a.length)];if(!s.has(c)){s.add(c);o.push({id:"d"+o.length,char:c})}}
 return o;
}

function render(){
 $("slots").innerHTML="";
 user.forEach((c,i)=>{
  const d=document.createElement("div");
  d.className="slot"+(c?"":" empty");
  d.innerText=c?c.char:"_";
  if(c)d.onclick=()=>{user[i]=null;render()}
  $("slots").appendChild(d);
 });
 $("keys").innerHTML="";
 keys.forEach(k=>{
  const b=document.createElement("div");
  b.className="key"+(user.some(u=>u&&u.id===k.id)?" used":"");
  b.innerText=k.char;
  b.onclick=()=>press(k);
  $("keys").appendChild(b);
 });
}

function press(k){
 const i=user.findIndex(x=>x===null);
 if(i<0)return;
 user[i]=k;render();
 if(!user.includes(null))check();
}

function check(){
 if(user.map(u=>u.char).join("")===target.join("")){
  let add=100*(boss?2:1)+Math.min(50,streak*10);
  if(boss&&first){add+=200;$("frame").classList.add("flash");setTimeout(()=>$("frame").classList.remove("flash"),600)}
  score+=add;streak++; if(boss)lives=Math.min(3,lives+1);
  update(); idx++; next();
 }else{
  first=false;streak=0;lives--;update();
  document.querySelectorAll(".slot").forEach(s=>s.classList.add("wrong"));
  setTimeout(()=>{user.fill(null);render(); if(lives<=0)end()},500);
 }
}

function update(){
 $("score").innerText=score;
 $("lives").innerText=[0,1,2].map(i=>i<lives?"‚ù§Ô∏è":"üíÄ").join("");
}

function end(){
 $("endModal").style.display="flex";
 $("endText").innerHTML=`PUAN: <b>${score}</b><br>STREAK: <b>${streak}</b><br><br>KELƒ∞ME:<br><b style="font-size:22px">${word}</b>`;
}

window.toggleSound=()=>{muted=!muted;$("soundBtn").innerText=muted?"üîá":"üîä";}
</script>
</body>
</html>
