<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>italkyAI</title>

  <script>
    (function () {

      const HOME = "/pages/home.html";
      const LOGIN = "/pages/login.html";
      const STORAGE_KEY = "italky_user_v1";

      function hasLocalUser() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          if (!raw) return false;
          const user = JSON.parse(raw);
          return !!user?.email;
        } catch {
          return false;
        }
      }

      function isNative() {
        return !!(window.Native && typeof window.Native.startGoogleLogin === "function");
      }

      function go(url) {
        location.replace(url);
      }

      // ðŸ”¥ 1) EÄŸer local user varsa direkt HOME
      if (hasLocalUser()) {
        go(HOME);
        return;
      }

      // ðŸ”¥ 2) APK ise direkt LOGIN'e
      if (isNative()) {
        go(LOGIN);
        return;
      }

      // ðŸ”¥ 3) Web tarafÄ± â†’ Supabase session kontrolÃ¼
      window.addEventListener("load", async function () {
        try {
          const { supabase } = await import("/js/supabase_client.js");
          const { data: { session } } = await supabase.auth.getSession();

          if (session) {
            go(HOME);
          } else {
            go(LOGIN);
          }
        } catch {
          go(LOGIN);
        }
      });

    })();
  </script>

</head>
<body style="background:#02000f;"></body>
</html>
